<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Daniel Fernandez">
<title>13&nbsp; Causalidad con DAGs – DataLab for causal inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../capitulos/Capítulo3.4.html" rel="next">
<link href="../capitulos/Capítulo3.2.html" rel="prev">
<link href="../cover.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>
  if (window.location.hostname === "danielferguz.github.io") {
    window.location.replace("https://datalabperu.cloudflareaccess.com/");
  }
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.html">Casualidad vs causalidad</a></li><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.3.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causalidad con DAGs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">DataLab for causal inference</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">capitulos/capitulo1.qmd</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Tipos de estudios de investigación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Diseños de investigación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tareas científicas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tareas descriptivas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tareas predictivas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tareas explicativas - inferencia causal</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../capitulos/Capítulo2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Capítulo 2: Medidas en epidemiología</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Medidas de Frecuencia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Medidas de Asociación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Medidas de Impacto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Entonces: ¿qué es la asociación?</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../capitulos/Capítulo3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Casualidad vs causalidad</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introducción a los fundamentos de los ensayos controlados aleatorios</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Inferencia causal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causalidad con DAGs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">set default theme</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">¡¡¡No todo es confusión!!!</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Muestreo</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Introducción a R y Quarto</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Limpieza y manejo de datos en R</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis descriptivos</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de asociación</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis inferencial en ECA</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis inferencial en EO</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis predictivos (diagnóstico)</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis predictivos (Pronóstico)</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Cálculo de tamaño muestral</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de series de tiempo</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis multinivel</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Manejo de datos perdidos</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de mediación</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Revisiones sistemáticas</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Evaluación de la certeza de la evidencia</span></span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#causalidad-y-grafos-causales" id="toc-causalidad-y-grafos-causales" class="nav-link active" data-scroll-target="#causalidad-y-grafos-causales"><span class="header-section-number">14</span> Causalidad y grafos causales</a></li>
  <li><a href="#medici%C3%B3n-de-efectos-causales" id="toc-medición-de-efectos-causales" class="nav-link" data-scroll-target="#medici%C3%B3n-de-efectos-causales"><span class="header-section-number">15</span> Medición de efectos causales</a></li>
  <li><a href="#dags-y-asociaciones-estad%C3%ADsticas" id="toc-dags-y-asociaciones-estadísticas" class="nav-link" data-scroll-target="#dags-y-asociaciones-estad%C3%ADsticas"><span class="header-section-number">16</span> DAGs y asociaciones estadísticas</a></li>
  <li><a href="#backdoors-and-do-calculus" id="toc-backdoors-and-do-calculus" class="nav-link" data-scroll-target="#backdoors-and-do-calculus"><span class="header-section-number">17</span> Backdoors and <em>do</em>-calculus</a></li>
  <li>
<a href="#dibujar-y-analizar-dags" id="toc-dibujar-y-analizar-dags" class="nav-link" data-scroll-target="#dibujar-y-analizar-dags"><span class="header-section-number">18</span> Dibujar y analizar DAGs</a>
  <ul class="collapse">
<li><a href="#dibujar-dags-con-dagitty" id="toc-dibujar-dags-con-dagitty" class="nav-link" data-scroll-target="#dibujar-dags-con-dagitty"><span class="header-section-number">18.1</span> Dibujar DAGs con DAGitty</a></li>
  <li><a href="#encontrar-conjuntos-de-ajuste-con-dagitty" id="toc-encontrar-conjuntos-de-ajuste-con-dagitty" class="nav-link" data-scroll-target="#encontrar-conjuntos-de-ajuste-con-dagitty"><span class="header-section-number">18.2</span> Encontrar conjuntos de ajuste con DAGitty</a></li>
  <li><a href="#dibujando-dags-con-r" id="toc-dibujando-dags-con-r" class="nav-link" data-scroll-target="#dibujando-dags-con-r"><span class="header-section-number">18.3</span> Dibujando DAGs con R</a></li>
  <li><a href="#encontrar-caminos-y-conjuntos-de-ajuste-con-r" id="toc-encontrar-caminos-y-conjuntos-de-ajuste-con-r" class="nav-link" data-scroll-target="#encontrar-caminos-y-conjuntos-de-ajuste-con-r"><span class="header-section-number">18.4</span> Encontrar caminos y conjuntos de ajuste con R</a></li>
  </ul>
</li>
  <li>
<a href="#ajustes" id="toc-ajustes" class="nav-link" data-scroll-target="#ajustes"><span class="header-section-number">19</span> Ajustes</a>
  <ul class="collapse">
<li><a href="#datos-simulados-sobre-mosquiteros" id="toc-datos-simulados-sobre-mosquiteros" class="nav-link" data-scroll-target="#datos-simulados-sobre-mosquiteros"><span class="header-section-number">19.1</span> Datos simulados sobre mosquiteros</a></li>
  <li><a href="#verificar-las-independencias-condicionales" id="toc-verificar-las-independencias-condicionales" class="nav-link" data-scroll-target="#verificar-las-independencias-condicionales"><span class="header-section-number">19.2</span> Verificar las independencias condicionales</a></li>
  <li><a href="#encontrar-el-conjunto-de-ajuste" id="toc-encontrar-el-conjunto-de-ajuste" class="nav-link" data-scroll-target="#encontrar-el-conjunto-de-ajuste"><span class="header-section-number">19.3</span> Encontrar el conjunto de ajuste</a></li>
  <li><a href="#estimaci%C3%B3n-ingenua-no-ajustada" id="toc-estimación-ingenua-no-ajustada" class="nav-link" data-scroll-target="#estimaci%C3%B3n-ingenua-no-ajustada"><span class="header-section-number">19.4</span> Estimación ingenua no ajustada</a></li>
  <li><a href="#regresi%C3%B3n" id="toc-regresión" class="nav-link" data-scroll-target="#regresi%C3%B3n"><span class="header-section-number">19.5</span> Regresión</a></li>
  <li><a href="#matching-emparejamiento" id="toc-matching-emparejamiento" class="nav-link" data-scroll-target="#matching-emparejamiento"><span class="header-section-number">19.6</span> Matching (Emparejamiento)</a></li>
  <li><a href="#inverse-probability-weighting" id="toc-inverse-probability-weighting" class="nav-link" data-scroll-target="#inverse-probability-weighting"><span class="header-section-number">19.7</span> Inverse probability weighting</a></li>
  <li><a href="#comparando-todos-los-m%C3%A9todos" id="toc-comparando-todos-los-métodos" class="nav-link" data-scroll-target="#comparando-todos-los-m%C3%A9todos"><span class="header-section-number">19.8</span> Comparando todos los métodos</a></li>
  </ul>
</li>
  <li><a href="#advertencias" id="toc-advertencias" class="nav-link" data-scroll-target="#advertencias"><span class="header-section-number">20</span> Advertencias</a></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias"><span class="header-section-number">21</span> Referencias</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.html">Casualidad vs causalidad</a></li><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.3.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causalidad con DAGs</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Causalidad con DAGs</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Cargando paquete requerido: sysfonts</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Cargando paquete requerido: showtextdb</code></pre>
</div>
</div>
<p>La advertencia común en estadísticas: “correlación no implica causalidad”, contrasta con la necesidad en ciencia política de entender causas detrás de fenómenos sociales y políticos. Ejemplos incluyen si el gasto gubernamental en educación reduce la desigualdad, o si el aumento del poder ejecutivo causa el colapso de regímenes. Estas preguntas son importantes, pero con los métodos estadísticos que cubriremos, solo podemos hablar de estas relaciones usando lenguaje asociativo. Encontramos que el gasto en educación se asocia con mayor desigualdad, y que la concentración del poder ejecutivo se asocia con una menor probabilidad de colapso del régimen. Aunque nos esforzamos en no usar lenguaje causal al interpretar estos coeficientes de regresión, estamos preocupados por la causalidad, especialmente si podemos influir en la política. Es fácil encontrar correlaciones significativas entre variables aparentemente no relacionadas. Por ejemplo, en EE. UU., el consumo per cápita de queso mozzarella está fuertemente correlacionado (<span class="math inline">\(r = 0.959\)</span>) con el número de doctorados en ingeniería civil otorgados. Sin embargo, la relación entre queso y grados no significa que consumir más queso creará nuevos doctores, ni que el aumento de ingenieros civiles cause un aumento en el consumo de queso. Podemos descartar fácilmente esta relación como espuria.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/dr-cheese.png" class="img-fluid figure-img" width="697"></p>
<figcaption>The high correlation between cheese and civil engineering</figcaption></figure>
</div>
</div>
</div>
<p>Menos probable considerar la relación entre gasto educativo e desigualdad como espuria. Hay numerosos estudios académicos publicados que investigan la relación genuina entre ellos. ¿Por qué? La diferencia en la plausibilidad de las dos relaciones va más allá de las estadísticas. No hay una historia causal creíble que vincule el consumo de queso y los títulos doctorales, a pesar de la alta correlación entre ambos. Sí hay una historia causal creíble entre la desigualdad y la educación, ya que mejorar la calidad de la educación aumenta las oportunidades laborales disponibles para los estudiantes después de graduarse.</p>
<p>Esta semana, presentamos un nuevo lenguaje no estadístico para crear, medir y evaluar historias y relaciones causales utilizando datos observacionales (es decir, no experimentales). Introducimos el concepto de grafos acíclicos dirigidos (DAG) causales que nos permiten codificar formalmente nuestra comprensión de las rutas o caminos causales. Con DAG bien elaborados, podemos usar un conjunto de reglas llamado <em>do</em>-cálculo para hacer ajustes específicos a modelos estadísticos y aislar o identificar relaciones causales entre variables de interés.</p>
<section id="causalidad-y-grafos-causales" class="level1" data-number="14"><h1 data-number="14">
<span class="header-section-number">14</span> Causalidad y grafos causales</h1>
<p>A diferencia de la correlación, que en su esencia es simplemente una fórmula matemática, no hay una función <code>causation()</code> en R. La causalidad es una cuestión de filosofía y teoría, no de matemáticas. Los debates sobre la definición de causalidad se han librado durante miles de años; Platón y Aristóteles escribieron sobre la metafísica y los componentes de las relaciones causales. Por simplicidad, en este capítulo usaremos una definición bastante universal: <span class="math inline">\(X\)</span> puede considerarse causa de <span class="math inline">\(Y\)</span> si:</p>
<ul>
<li>
<strong>Association</strong>: <span class="math inline">\(X\)</span> y <span class="math inline">\(Y\)</span> están <em>asociados</em> entre sí</li>
<li>
<strong>Time ordering</strong>: <span class="math inline">\(X\)</span> <em>precede</em> a <span class="math inline">\(Y\)</span>
</li>
<li>
<strong>Nonspuriousness</strong>: La asociación entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> <em>no es espuria</em>
</li>
</ul>
<p>More simply, we can collapse all three of these conditions into a single definition:</p>
<blockquote class="blockquote">
<p>Más simplemente, podemos resumir estas tres condiciones en una sola definición: Una variable <span class="math inline">\(X\)</span> es causa de una variable <span class="math inline">\(Y\)</span> si <span class="math inline">\(Y\)</span> de alguna manera depende de <span class="math inline">\(X\)</span> para su valor.… <span class="math inline">\(X\)</span> es causa de <span class="math inline">\(Y\)</span> si <span class="math inline">\(Y\)</span> escucha a <span class="math inline">\(X\)</span> y decide su valor en respuesta a lo que escucha <span class="citation" data-cites="PearlGlymourJewell:2016">[@PearlGlymourJewell:2016, 5--6]</span></p>
</blockquote>
<p>El concepto de variables “<em>escuchándose</em>” entre sí incorpora simultáneamente asociación, orden temporal y no espuriedad. Consideremos la relación entre encender un interruptor de luz y encender una bombilla. El acto de habilitar un interruptor de luz está asociado con una bombilla que emite luz, lo que indica una asociación entre los dos. Una bombilla no puede emitir luz antes de que se encienda, asegurando así el orden temporal correcto: se debe activar el interruptor antes de que la luz se encienda. Finalmente, la asociación no es espuria ya que hay un vínculo plausible entre los dos: los pulsos eléctricos viajan a través de cables hacia equipos que transforman la energía en corriente que puede alimentar la bombilla. También podemos decir más simplemente que una bombilla “escucha” al interruptor de luz. Los cambios en el estado de encendido/apagado del interruptor influyen en el estado de la bombilla más abajo en la cadena causal. Una bombilla escucha muchos otros factores: la electricidad debe fluir hacia el edificio, los transformadores deben funcionar correctamente y múltiples interruptores pueden controlar la misma luz, pero un solo interruptor definitivamente es una de las causas de emitir luz.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/general-examples.png" class="img-fluid figure-img" width="684"></p>
<figcaption>Various DAGs</figcaption></figure>
</div>
</div>
</div>
<p>Podemos codificar la filosofía o teoría de una cadena causal de eventos en un grafo acíclico dirigido, o DAG. Los DAG son modelos gráficos del proceso que genera los datos y esbozan cómo <span class="math inline">\(X\)</span> causa <span class="math inline">\(Y\)</span> (ver panel A de la Figura @ref(fig:general-examples)). Estos gráficos consisten en tres elementos principales: nodos, aristas (o flechas) y dirección. Los nodos representan fenómenos que tienen relaciones causales con otros elementos en el sistema. Estos pueden ser cosas que son medibles y podrían incluir un conjunto de datos, como el PIB, la población, el partido político, el tiempo en el cargo, los ingresos, la ubicación geográfica o el estatus socioeconómico. Los nodos no necesariamente deben ser medibles: limitaciones en la recolección de datos o variables abstractas pueden hacer imposible recolectar mediciones confiables sobre diferentes fenómenos. Si este es el caso, el nodo aún debe incluirse en el grafo, pero se debe considerar como no observado o latente. Los nodos también representan variables de tratamiento y resultado (ver panel B en la Figura @ref(fig:general-examples)).</p>
<p><strong>Las aristas</strong> (o flechas) transmiten asociaciones entre nodos. Por ejemplo, si un grafo muestra que <span class="math inline">\(X \rightarrow Y\)</span>, <span class="math inline">\(X\)</span> tiene una asociación causal con <span class="math inline">\(Y\)</span>, o <span class="math inline">\(Y\)</span> “escucha” o responde a <span class="math inline">\(X\)</span>. Es crucial destacar que la ausencia de una arista entre nodos implica que no hay relación causal entre los nodos. Las asociaciones causales entre nodos solo pueden fluir en una dirección—las flechas nunca pueden ir en ambas direcciones (por ejemplo, <span class="math inline">\(X \leftrightarrow Y\)</span>), y debería ser imposible regresar a cualquier nodo dado mientras se camina a través del grafo (por ejemplo, <span class="math inline">\(X \rightarrow Z \rightarrow Y \rightarrow Z \rightarrow X\)</span>). A menudo hay una razón válida para incluir aristas de bucle o retroalimentación. Por ejemplo, los gastos en educación pueden llevar a la desigualdad, que luego conduce a cambios en los gastos en educación. En estas situaciones, en lugar de incluir flechas bidireccionales, es mejor distinguir entre los dos períodos de gastos en educación, a menudo usando el subíndice <span class="math inline">\(t\)</span> para el tiempo: <span class="math inline">\(X_{t-1} \rightarrow Y_{t-i} \rightarrow X_t \rightarrow Y_t\)</span> (ver panel C en la Figura @ref(fig:general-examples)).</p>
<p>La presencia y ausencia de nodos, flechas y dirección en un DAG comunica nuestra teoría y filosofía de la causalidad. El uso de DAGs hace que sea claro para la audiencia cuáles son tus suposiciones. La vinculación de nodos implica que hay una relación estadística entre dos fenómenos, mientras que omitir un nodo o una flecha implica que el nodo no juega ningún papel en la historia causal. Si los lectores quieren cuestionar tu teoría de la causalidad, pueden hacerlo fácilmente consultando el DAG y observando qué nodos y flechas deberían incluirse o excluirse.</p>
</section><section id="medición-de-efectos-causales" class="level1" data-number="15"><h1 data-number="15">
<span class="header-section-number">15</span> Medición de efectos causales</h1>
<p>Dado que la causalidad significa que <span class="math inline">\(Y\)</span> escucha a <span class="math inline">\(X\)</span>, medir el efecto de <span class="math inline">\(X\)</span> en <span class="math inline">\(Y\)</span> requiere que puedas manipular <span class="math inline">\(X\)</span> directamente para ver qué le sucede a <span class="math inline">\(Y\)</span>. Podemos usar una notación matemática especial para representar intervenciones directas: el <em>do</em>-operador, o <span class="math inline">\(do(\cdot)\)</span>. Si <span class="math inline">\(Y\)</span> escucha a <span class="math inline">\(X\)</span>, podemos decir que hay algún valor esperado de <span class="math inline">\(Y\)</span> cuando “hacemos” <span class="math inline">\(X\)</span>, o <span class="math inline">\(E(Y | do(X))\)</span> (léelo como “el valor esperado de Y dado que hace X”). Podemos hacer que esta notación sea un poco más fácil de entender con algunos ejemplos de preguntas causales:</p>
<ul>
<li><p><span class="math inline">\(E(\text{Votos ganados}\ | \ do(\text{Recaudación de fondos de campaña}))\)</span>: El efecto de “hacer” (es decir, participar en) la recaudación de fondos de campaña en el número de votos ganados en una elección.</p></li>
<li><p><span class="math inline">\(E(\text{Desigualdad}\ | \ do(\text{Gastos en educación}))\)</span>: El efecto de “hacer” gastos en educación (es decir, gastar dinero) en el nivel de desigualdad social de un país.</p></li>
<li><p><span class="math inline">\(E(\text{Calidad del aire}\ | \ do(\text{Impuesto al carbono}))\)</span>: El efecto de “hacer” (es decir, implementar) un impuesto al carbono en la calidad del aire de un país.</p></li>
<li><p><span class="math inline">\(E(\text{Tasa de infección de malaria}\ | \ do(\text{Mosquitero}))\)</span>: El efecto de “hacer” (es decir, usar) un mosquitero en la tasa de infección de malaria de una aldea.</p></li>
</ul>
<p>Para medir el efecto causal de una intervención, necesitamos comparar el valor esperado del resultado (<span class="math inline">\(E(Y)\)</span>) cuando intervenimos y cuando no intervenimos con <span class="math inline">\(X\)</span>. Por ejemplo, podemos comparar lo que sucede con una bombilla cuando activamos un interruptor con lo que sucede con una bombilla cuando no activamos el interruptor. Restar la diferencia entre estos dos estados del mundo da como resultado un efecto causal:</p>
<p><span class="math display">\[
\text{Efecto causal del interruptor de luz} = E(\text{Luz}\ | \ do(\text{Interruptor = Encendido})) - E(\text{Luz}\ | \ do(\text{Interruptor = Apagado}))
\]</span></p>
<p>Podemos escribir esta definición de manera más general usando algunos símbolos matemáticos adicionales. Aquí, <span class="math inline">\(\delta\)</span> representa el efecto causal y el subíndice <span class="math inline">\(i\)</span> representa a un individuo específico (es decir, comparar los efectos en la misma bombilla):</p>
<p><span class="math display">\[
\delta_i = E(Y\ | \ do(X = 1))_i - E(Y\ | \ do(X = 0))_i
\]</span></p>
<p>Calcular el efecto causal <span class="math inline">\(\delta_i\)</span> en el mundo físico es bastante sencillo. Encuentra dos bombillas idénticas, enciende una ( <span class="math inline">\(do(\text{Interruptor = Encendido})\)</span>), deja la otra apagada ( <span class="math inline">\(do(\text{Interruptor = Apagado})\)</span>), y compara la luz emitida. O, dado que una bombilla única aparentemente no cambia con el tiempo, mide el cambio de luz dentro de la misma bombilla.</p>
<p>Sin embargo, medir el efecto causal de las intervenciones en personas individuales, provincias o países es mucho más difícil. No podemos medir <span class="math inline">\(E(Y | do(X = 1))_i\)</span> en un individuo y luego retroceder en el tiempo para medir <span class="math inline">\(E(Y | do(X = 0))_i\)</span> en ese mismo individuo. Esto plantea el <em>problema fundamental de la inferencia causal</em>: los efectos causales a nivel individual son imposibles de observar porque no podemos ver los contrafactuales a nivel individual.</p>
<p>En lugar de medir efectos a nivel individual, es más fácil (y en realidad factible) medir los resultados promedio para cada unidad en un grupo. Podemos encontrar el <em>efecto promedio del tratamiento (ATE)</em> calculando la diferencia entre el valor esperado del resultado promedio (<span class="math inline">\(\bar{Y}\)</span>) para aquellos que <span class="math inline">\(hacen(X)\)</span> y aquellos que no lo hacen:</p>
<p><span class="math display">\[
\delta_\text{ATE} = E(\bar{Y}\ | \ do(X = 1)) - E(\bar{Y}\ | \ do(X = 0))
\]</span></p>
<p>Bajo condiciones experimentales, como ensayos controlados aleatorios donde los participantes se asignan aleatoriamente para recibir tratamiento o no, los grupos que <span class="math inline">\(Do(X = 1)\)</span> y <span class="math inline">\(Do(X = 0)\)</span> generalmente serán comparables porque ningún individuo se seleccionó voluntariamente en o fuera del tratamiento. Si la aleatorización se hace bien, el ATE que calculamos debería ser imparcial y preciso.</p>
<p>Existen muchas técnicas econométricas para identificar y estimar efectos causales a partir de datos observacionales, incluidos experimentos naturales, análisis de diferencias en diferencias, análisis de regresión discontinua y variables instrumentales. En general, estos métodos intentan aproximar grupos de tratamiento y control, organizando individuos o países en grupos comparables y eliminando el sesgo de selección. Además de estos enfoques, podemos utilizar la lógica de los modelos causales para identificar relaciones causales, eliminar el confusión estadística y utilizar datos observacionales para estimar efectos causales válidos.</p>
</section><section id="dags-y-asociaciones-estadísticas" class="level1" data-number="16"><h1 data-number="16">
<span class="header-section-number">16</span> DAGs y asociaciones estadísticas</h1>
<p>Dibujar nodos y flechas es útil para entender los diversos elementos de un fenómeno social, pero por sí solos, los nodos y flechas no identifican relaciones causales. Un efecto causal se considera identificado si la asociación entre el nodo de tratamiento y el nodo de resultado está aislada y despojada de asociaciones estadísticas que provienen de otros nodos en el grafo.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/association-examples.png" class="img-fluid figure-img" width="687"></p>
<figcaption>Basic types of relationships in DAGs</figcaption></figure>
</div>
</div>
</div>
<p>La <em>dirección</em> de las flechas a lo largo de los caminos entre los nodos en un grafo determina cómo se transmiten las asociaciones estadísticas entre los nodos. Para ilustrar cómo ciertas relaciones direccionales pueden transmitir asociaciones estadísticas entre nodos en un grafo, supongamos que dos variables <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> no están relacionadas entre sí. Podemos decir esto con notación matemática usando el símbolo <span class="math inline">\(\perp\)</span>: <span class="math inline">\(X \perp Y\)</span> significa que <span class="math inline">\(X\)</span> es independiente de <span class="math inline">\(Y\)</span> (y <span class="math inline">\(X \not\perp Y\)</span> significa que las dos variables no son independientes). En el lenguaje de los grafos causales, podemos decir que si <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> son independientes entre sí, están <em>d-separados</em> (el <strong>d-</strong> representa “dirección”). Si <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> no son independientes entre sí, están <em>d-conectados</em> las características de las relaciones direccionales en el grafo causal conectan las dos variables y permiten que la información pase entre ellas. La Figura @ref(fig:association-examples) muestra cómo la inclusión de un tercer nodo <span class="math inline">\(Z\)</span> en el camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> cambia la relación estadística entre ambos e influye en si están <em>d-separados</em> o <em>d-conectados</em>.</p>
<ol type="1">
<li><p><strong>Mediators</strong>: En el panel A, <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> están correlacionados entre sí debido a la variable mediadora <span class="math inline">\(Z\)</span>. Cualquier cambio en <span class="math inline">\(X\)</span> causará cambios en <span class="math inline">\(Y\)</span> aguas abajo a través de <span class="math inline">\(Z\)</span>. El camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> es así <em>abierto</em> y <span class="math inline">\(X \not\perp Y\)</span>. <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> están <em>d-conectados</em>.</p></li>
<li><p><strong>Confounders</strong>: En el panel B, aunque <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> no se causan mutuamente, <span class="math inline">\(Z\)</span> es una causa común de ambos y confunde la relación. Cualquier cambio en <span class="math inline">\(Z\)</span> causará cambios tanto en <span class="math inline">\(X\)</span> como en <span class="math inline">\(Y\)</span>, eliminando así cualquier independencia estadística entre los dos. El camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> es así <em>abierto</em> y, nuevamente, <span class="math inline">\(X \not\perp Y\)</span>. <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> están <em>d-conectados</em>.</p></li>
</ol>
<p>En realidad, <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> deberían ser independientes entre sí, pero en el caso tanto de <strong>mediadores</strong> como de <strong>confundidores</strong>, <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> están <strong>d-conectados</strong> porque <span class="math inline">\(Z\)</span> abre un camino entre los dos y pasa información entre ellos.</p>
<p>Un elemento poderoso de la lógica de los diagramas causales es que podemos controlar el flujo de información estadística bloqueando y abriendo caminos entre nodos. Tanto para mediadores como para confundidores, si podemos detener la asociación entre tanto <span class="math inline">\(X\)</span> como <span class="math inline">\(Z\)</span> y <span class="math inline">\(Z\)</span> y <span class="math inline">\(Y\)</span>, <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> volverán a ser independientes entre sí y estarán <em>d-separados</em>. Para hacer esto, podemos ajustar o condicionar <span class="math inline">\(Z\)</span> eliminando las partes de <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> que son explicadas por <span class="math inline">\(Z\)</span>. Hay muchas maneras de ajustar variables. Una forma básica de pensar en ajustar variables es con regresión: si ejecutamos una regresión e incluimos <span class="math inline">\(Z\)</span> como una variable de control (por ejemplo, <em>lm(Y ~ X + Z)</em>), el coeficiente para <span class="math inline">\(Z\)</span> representará (y eliminará) la variación conjunta de <span class="math inline">\(Z\)</span> en tanto <span class="math inline">\(X\)</span> como <span class="math inline">\(Y\)</span>. <em>Una vez que ajustamos</em> por <span class="math inline">\(Z\)</span>, el camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> está bloqueado y los dos están <em>d-separados</em>. Matemáticamente, podemos escribir esto como <span class="math inline">\(X \perp Y | Z\)</span>, o <span class="math inline">\(X\)</span> es independiente de <span class="math inline">\(Y\)</span> <strong>condicional</strong> a <span class="math inline">\(Z\)</span>.</p>
<p>El concepto de bloqueo o condicionamiento nos ayuda a comprender el último tipo de relación entre nodos:</p>
<ol start="3" type="1">
<li>
<strong>Colliders</strong>: En el panel C de la Figura @ref(fig:association-examples), <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> son causas comunes de <span class="math inline">\(Z\)</span>, pero cada uno es independiente del otro. El camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> está cerrado porque está bloqueado por <span class="math inline">\(Z\)</span>. <span class="math inline">\(X \perp Y\)</span> y <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> están <em>d-separados</em>. Si controlamos por <span class="math inline">\(Z\)</span> en un modelo de regresión, inadvertidamente abriremos el camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> y crearemos una relación estadística espuria entre los dos.</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/money-votes-simple.jpg" style="width:80.0%;height:20.0%" class="figure-img"></p>
<figcaption>Simplified DAG showing the relationship between campaign spending and votes won in an election</figcaption></figure>
</div>
</div>
</div>
<p>Hasta ahora, hemos hablado de grafos DAG y d-separación en abstracto con <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> y <span class="math inline">\(Z\)</span>. La Figura @ref(fig:money-votes-simple) proporciona un grafo causal más concreto que ilustra simultáneamente todas estas relaciones. Supongamos que estamos interesados en el efecto causal de la recaudación de fondos de campaña (<span class="math inline">\(X\)</span>) en el total de votos (<span class="math inline">\(Y\)</span>). En este caso, ya no asumimos que <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span> son independientes entre sí (es decir, <span class="math inline">\(X \perp Y\)</span>)—queremos medir la relación entre los dos. Sin embargo, para aislar esa relación, debemos asegurarnos de que el camino entre el dinero de la campaña y los votos totales sea el único camino d-conectado en el grafo. Cada uno de los otros nodos en el grafo—“gerente de campaña contratado,” “calidad del candidato,” y “ganó la elección”—transmite diferentes tipos de asociaciones estadísticas entre el dinero y el éxito electoral. Podemos examinarlos por turno:</p>
<ol type="1">
<li><p>La relación entre el dinero y los votos totales está <strong>mediada</strong> por la contratación de un gerente de campaña. Cualquier cambio en la recaudación de fondos tiene un efecto en la cantidad de votos ganados, pero la recaudación de fondos también influye en las posibilidades de contratar a un gerente de campaña, lo que luego tiene un efecto en los votos totales. El camino entre el dinero y los votos está abierto debido a la variable mediadora del gerente de campaña.</p></li>
<li><p>La relación entre el dinero y el éxito electoral está <strong>confundida</strong> por la calidad del candidato. Los candidatos de alta calidad tienen más probabilidades de recaudar más dinero y ganar elecciones, lo que significa que la relación entre el dinero y el éxito electoral ya no está aislada. Si <em>ajustamos</em> por la calidad del candidato y comparamos candidatos de la misma calidad (o controlamos la calidad en una regresión, manteniendo la calidad constante), podemos cerrar el camino entre el dinero y el éxito y aislar el camino.</p></li>
<li><p>Ganar una elección es un <strong>colisionador</strong> en el camino entre el dinero y el éxito electoral. Si ajustamos por ganar la elección (es decir, solo miramos a los candidatos ganadores), la relación real entre el dinero y el éxito electoral se verá distorsionada. El sesgo del colisionador es un tipo de sesgo de selección: al solo mirar campañas exitosas, perdemos la relación entre el dinero y el éxito para los candidatos que no ganaron, y nuestras estimaciones serán incorrectas. No debemos controlar por ganar una elección.</p></li>
</ol>
<p>Conocer la dirección de las flechas entre los nodos en un DAG proporciona una guía útil sobre qué controlar o ajustar. Si queremos aislar la relación entre la recaudación de fondos de campaña y el éxito electoral, debemos controlar por la calidad del candidato (ya que es un confundidor) y no debemos controlar por ganar la elección (ya que es un colisionador). La decisión de ajustar por tener un gerente de campaña depende de nuestra pregunta de investigación. Si ajustamos por ello, eliminaremos el efecto del gerente de campaña del efecto total de la recaudación de fondos en los votos, y el efecto restante de <span class="math inline">\(X\)</span> en <span class="math inline">\(Y\)</span> será realmente <span class="math inline">\(X\)</span> sin el efecto del gerente de campaña. Si estamos interesados en el efecto total de la recaudación de fondos, incluido cualquier efecto que provenga de tener un gerente de campaña, <strong>no</strong> debemos controlar por tener un gerente de campaña.</p>
</section><section id="backdoors-and-do-calculus" class="level1" data-number="17"><h1 data-number="17">
<span class="header-section-number">17</span> Backdoors and <em>do</em>-calculus</h1>
<p>Siguiendo el problema fundamental de la inferencia causal (es decir, debido al hecho de que no tenemos una máquina del tiempo), responder a preguntas causales sin un experimento parece imposible. Sin embargo, si aplicamos a nuestro grafo causal un conjunto especial de reglas lógicas llamado <strong>do</strong>-<em>calculus</em>, podemos eliminar cualquier relación de confusión entre nuestros nodos de tratamiento y resultado y aislar el efecto causal entre ellos utilizando únicamente datos observacionales.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/rct-dag.jpg" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>Edges in a DAG are deleted when using the <span class="math inline">\(do(\cdot)\)</span> operator</figcaption></figure>
</div>
</div>
</div>
<p>El operador do representa una intervención directa en un DAG y nos permite establecer un nodo en un valor específico. Por ejemplo, en un ensayo controlado aleatorio, nosotros, como investigadores, tenemos control sobre quién se asigna a los grupos de tratamiento y control en la intervención. El efecto causal (o <span class="math inline">\(\delta\)</span>) que encontramos luego del ensayo es el efecto de <span class="math inline">\(X\)</span> en nuestro resultado <span class="math inline">\(Y\)</span> cuando realizamos la acción <span class="math inline">\(do(X = \text{Treatment})\)</span>. En entornos experimentales, una intervención <span class="math inline">\(do(\cdot)\)</span> implica que todas las flechas que llegan al nodo de tratamiento se eliminan (ver Figura @ref(fig:rct-arrow-deletion)). Esto asegura que <span class="math inline">\(X\)</span> está d-separado de <span class="math inline">\(Y\)</span> y la flecha entre <span class="math inline">\(X\)</span> y <span class="math inline">\(Y\)</span> está completamente aislada e identificada. Sin embargo, con datos observacionales, no es posible estimar <span class="math inline">\(E(Y | do(X))\)</span> porque como investigadores, no tenemos control sobre <span class="math inline">\(X\)</span>. No podemos asignar algunos países para aumentar el gasto en educación y otros para disminuirlo como parte de un experimento para ver cómo cambia la desigualdad social, o asignar algunas campañas para gastar un esfuerzo adicional en recaudación de fondos para ver el efecto del dinero en los votos. En lugar de <span class="math inline">\(E(Y | do(X))\)</span>, que es nuestra cantidad principal de interés, solo podemos estimar <span class="math inline">\(E(Y | X)\)</span>, o el valor esperado de <span class="math inline">\(Y\)</span> dado los niveles existentes de <span class="math inline">\(X\)</span> (es decir, la correlación entre los dos). Desafortunadamente, la frase con la que se abrió este capítulo—“la correlación no implica causalidad”—es cierta aquí: <span class="math inline">\(E(Y | X) \neq E(Y | do(X))\)</span>. Para estimar un efecto causal a partir de datos observacionales, necesitamos transformar <span class="math inline">\(E(Y | do(X))\)</span> en algo que esté libre de do, ya que no podemos realizar realmente una intervención do.</p>
<p>Un conjunto de tres reglas lógicas especiales llamadas “do-cálculo” nos permite hacer precisamente eso: mediante la aplicación de diferentes reglas, podemos eliminar los operadores <span class="math inline">\(do(\cdot)\)</span> de los DAGs e identificar efectos causales solo con datos observacionales.</p>
<p>Una derivación particular de las reglas de do-cálculo define un criterio especial de puerta trasera que nos permite eliminar los operadores <span class="math inline">\(do(\cdot)\)</span> ajustando variables confusoras a lo largo del camino entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>. El criterio de puerta traseraestablece que el efecto causal de <span class="math inline">\(X\)</span> en <span class="math inline">\(Y\)</span> es identificable (es decir, puede aislarse) después de ajustar el conjunto de variables confusoras <span class="math inline">\(Z\)</span>, utilizando la fórmula:</p>
<p><span class="math display">\[
P(Y | do(X)) = \sum_Z P(Y | X, Z) \times P(Z)
\]</span></p>
<p>Por el bien de esta sesión, la derivación exacta e interpretación de esta fórmula son menos importantes que la intuición. Según este criterio de puerta trasera, el operador do en el lado izquierdo de la ecuación puede transformarse en una expresión libre de do en el lado derecho, estimada con <span class="math inline">\(P(Y | X, Z)\)</span> (la distribución de <span class="math inline">\(Y\)</span> condicionada tanto a <span class="math inline">\(X\)</span> como a <span class="math inline">\(Z\)</span>) y <span class="math inline">\(P(Z)\)</span> (la distribución de <span class="math inline">\(Z\)</span>), que se pueden estimar utilizando solo datos observacionales.</p>
<p>En la práctica, el ajuste de puerta trasera suele ser mucho más intuitivo que intentar derivar fórmulas largas. En lugar de ello, es posible encontrar y ajustar confusores de caminos de puerta trasera gráficamente utilizando un DAG siguiendo este proceso:</p>
<ol type="1">
<li><p>Enumere todos los caminos entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>, independientemente de la dirección de las flechas.</p></li>
<li><p>Identifique cualquier camino que tenga flechas que apunten hacia atrás hacia <span class="math inline">\(X\)</span>.</p></li>
<li><p>Los nodos que apuntan hacia atrás a <span class="math inline">\(X\)</span> son confusores y, por lo tanto, abren caminos de portillo trasero. Estos deben ajustarse.</p></li>
</ol>
<p>Podemos aplicar este proceso al DAG en la Figura <span class="citation" data-cites="ref">@ref</span>(fig:money-votes-simple). Estamos interesados en el efecto de la recaudación de fondos de campaña en el número de votos ganados en una elección, o <span class="math inline">\(E(\text{Votos ganados} | do(\text{Recaudación de fondos de campaña}))\)</span>. Como no asignamos experimentalmente algunas campañas para recaudar fondos y otras no, solo podemos trabajar con datos observacionales, lo que nos deja solo con la correlación entre la recaudación de fondos de campaña y los votos, o <span class="math inline">\(E(\text{Votos ganados} |\ \text{Recaudación de fondos de campaña})\)</span>. Si observamos el gráfico causal, hay cuatro caminos entre “Dinero recaudado” y “Votos totales”:</p>
<ul>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Calidad del candidato} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Contrató gerente de campaña} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Ganó la elección} \leftarrow \text{Votos totales}\)</span></p></li>
</ul>
<p>En el segundo camino, “Calidad del candidato” apunta hacia atrás en “Dinero recaudado” y es un confusor que abre un camino de puerta trasera entre la recaudación de fondos y los votos. Los primeros, terceros y cuartos caminos solo tienen flechas que apuntan hacia la derecha y no introducen confusión. Si ajustamos por calidad y la mantenemos constante, aseguramos que la relación entre la recaudación de fondos y los votos esté d-separadas de todos los demás nodos y, por lo tanto, esté aislada e identificada.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/money-votes-complex.jpg" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>More complicated DAG showing the relationship between campaign spending and votes won in an election</figcaption></figure>
</div>
</div>
</div>
<p>El mismo razonamiento se aplica también a DAGs más complejos. Considere la Figura @ref(fig:money-votes-complex), que es una versión expandida de la Figura @ref(fig:money-votes-simple) con tres nodos nuevos: el partido político del candidato, el distrito en el que se postula el candidato y la historia no observada tanto del distrito como del partido, que influye en la toma de decisiones del partido y en la dinámica demográfica del distrito. Estamos interesados en identificar o aislar el camino entre la recaudación de fondos y los votos totales, pero hay caminos confusos que d-separan la vía causal que nos interesa. Podemos cerrar estas puertas traseras para aislar el efecto causal. Primero, enumeramos todos los caminos entre “Dinero recaudado” y “Votos totales”:</p>
<ul>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Contrató gerente de campaña} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \rightarrow \text{Ganó la elección} \leftarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Calidad del candidato} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Distrito} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Partido} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Distrito} \leftarrow \text{History} \rightarrow \text{Partido} \rightarrow \text{Votos totales}\)</span></p></li>
<li><p><span class="math inline">\(\text{Dinero recaudado} \leftarrow \text{Party} \leftarrow \text{History} \rightarrow \text{Distrito} \rightarrow \text{Votos totales}\)</span></p></li>
</ul>
<p>De estos ocho caminos posibles, los últimos cinco tienen flechas que apuntan hacia la izquierda en “Dinero recaudado” desde tres nodos únicos: calidad del candidato, partido y distrito. Por lo tanto, debemos ajustar por calidad, partido y distrito para cerrar estos caminos de puerta trasera y asegurar que la conexión entre el dinero y los votos esté identificada. Es importante tener en cuenta que la historia, que no es medible, también es un confusor. Sin embargo, debido a que cerramos el partido y el distrito mediante ajuste, la historia no confunde estadísticamente el dinero y los votos. Aunque es latente e inmedible, los nodos posteriores que son medibles nos permiten cerrar sus efectos de puerta trasera. También note que “Ganó la elección” es un colisionador, no un confusor, y no debería ajustarse para evitar la creación de conexiones espurias entre el dinero y los votos, y “Contrató gerente de campaña” es un mediador y no debería ajustarse si estamos interesados en el efecto total del dinero en los votos.</p>
<p>El criterio de puerta trasera no es el único método para encontrar qué nodos deben ajustarse. Otro método común es el criterio de <strong>puerta delantera</strong>, que se basa en variables mediadoras d-separadas para identificar la relación entre <span class="math inline">\(X\)</span> e <span class="math inline">\(Y\)</span>. Los DAGs complejos que no se ajustan fácilmente a los criterios de puerta trasera o delantera pueden utilizar la aplicación de las reglas de do-cálculo para encontrar conjuntos de ajuste apropiados y factibles. Se han desarrollado algoritmos especiales para trabajar a través de las reglas de do-cálculo para determinar si un efecto es identificable—el paquete causaleffect en R incluye funciones para ejecutar estos algoritmos.</p>
<p>Es importante destacar que no siempre es posible identificar efectos causales en un DAG. Si no hay forma de traducir <span class="math inline">\(P(Y | do(X))\)</span> a una expresión libre de do utilizando do-cálculo, entonces es imposible aislar e identificar la relación causal utilizando datos observacionales.</p>
</section><section id="dibujar-y-analizar-dags" class="level1" data-number="18"><h1 data-number="18">
<span class="header-section-number">18</span> Dibujar y analizar DAGs</h1>
<p>Dado que los DAGs son una colección de nodos y flechas, son simples de dibujar. Recomiendo dibujarlos a mano en papel o en una pizarra cuando esté mapeando por primera vez su teoría causal, y luego transferir el borrador escrito a mano a una computadora. Aunque es posible usar muchos programas informáticos diferentes para dibujar DAGs, incluidos Microsoft PowerPoint o Adobe Illustrator, es mejor usar software de graficación creado específicamente para DAGs, como DAGitty o el paquete <strong>ggdag</strong> en R.</p>
<section id="dibujar-dags-con-dagitty" class="level2" data-number="18.1"><h2 data-number="18.1" class="anchored" data-anchor-id="dibujar-dags-con-dagitty">
<span class="header-section-number">18.1</span> Dibujar DAGs con DAGitty</h2>
<p>DAGitty (<a href="https://www.dagitty.net" class="uri">https://www.dagitty.net</a>) es un editor gráfico en el navegador para crear y analizar diagramas causales. Al señalar y hacer clic, puede crear nodos y vincularlos entre sí con bordes. También puede asignar nodos específicos para ser tratamiento, resultado y variables latentes/no observadas, que tienen su propio esquema de color. Puede exportar DAGs como archivos PNG, JPG y SVG para incluirlos en otros documentos. La Figura @ref(fig:example-dagitty) muestra un ejemplo de un gráfico causal hecho en DAGitty. Consulte el <a href="http://dagitty.net/manual-3.x.jpg">manual en línea</a> para obtener más detalles sobre las funciones de DAGitty, o dedique unos minutos a jugar para acostumbrarse a agregar y conectar nodos.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/dagitty-mosquito-nets.jpg" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>Example DAG built in DAGitty</figcaption></figure>
</div>
</div>
</div>
</section><section id="encontrar-conjuntos-de-ajuste-con-dagitty" class="level2" data-number="18.2"><h2 data-number="18.2" class="anchored" data-anchor-id="encontrar-conjuntos-de-ajuste-con-dagitty">
<span class="header-section-number">18.2</span> Encontrar conjuntos de ajuste con DAGitty</h2>
<p>DAGitty colorea automáticamente los nodos y las vías según si están abiertos o no. Por ejemplo, en la Figura @ref(fig:example-dagitty), los nodos para las temperaturas nocturnas, los ingresos y las condiciones de salud son todos rojos, lo que indica que confunden la relación entre el tratamiento y el resultado. Puede especificar que estos nodos se ajustarán y limpiarán el camino.</p>
<p>En la barra lateral derecha, DAGitty incluye una lista de nodos que deben ajustarse para identificar el efecto causal. Si el efecto es identificable, enumerará todos los conjuntos mínimamente suficientes de nodos; si no es identificable, DAGitty le informará. Para el DAG en la Figura @ref(fig:example-dagitty), el conjunto de ajuste mínimamente suficiente incluye temperaturas nocturnas, ingresos y condiciones de salud subyacentes (consulte la Figura @ref(fig:dagitty-adjust-implications)).</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/dagitty-mosquito-nets-details.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>Minimal sufficient adjustment sets and testable implications for a DAGitty model</figcaption></figure>
</div>
</div>
</div>
<p>La barra lateral derecha también incluye una lista de todas las implicaciones comprobables del DAG. Recuerde que después del ajuste, ciertos nodos se vuelven d-separados y, por lo tanto, no pasan asociaciones estadísticas entre ellos. Basándose en este DAG, después de ajustar las temperaturas nocturnas, los ingresos y las condiciones de salud subyacentes, algunas de las siguientes afirmaciones deberían ser verdaderas:</p>
<ul>
<li><p><span class="math inline">\(\text{Ingresos} \perp \text{Resistencia al insecticida}\)</span>: Los ingresos deberían ser independientes de la resistencia al insecticida</p></li>
<li><p><span class="math inline">\(\text{Ingresos} \perp \text{Temperaturas nocturnas}\)</span>: Los ingresos deberían ser independientes de las temperaturas nocturnas</p></li>
<li><p><span class="math inline">\(\text{Número en el hogar} \perp \text{Condiciones de salud subyacentes}\ |\ \text{Ingresos}\)</span>: El número de personas en un hogar debería ser independiente de las condiciones de salud subyacentes en niveles similares de ingresos</p></li>
</ul>
<p>Cada una de estas afirmaciones es comprobable con datos reales. Si tiene columnas en un conjunto de datos para estos diferentes nodos, puede usar R para verificar las correlaciones entre ellos (es decir, <code>cor(data$income, data$temperature)</code> o <code>lm(numero_hogar ~ condiciones_salud + ingresos)</code>) y ver si realmente son independientes entre sí.</p>
</section><section id="dibujando-dags-con-r" class="level2" data-number="18.3"><h2 data-number="18.3" class="anchored" data-anchor-id="dibujando-dags-con-r">
<span class="header-section-number">18.3</span> Dibujando DAGs con R</h2>
<p>El paquete <strong>ggdag</strong> de R le permite utilizar <strong>ggplot2</strong> para crear y analizar DAGs con R. La documentación del paquete está llena de ejemplos útiles de toda la gama de funciones del paquete. A continuación se presentan algunos ejemplos de las cosas más comunes que puede hacer con eso</p>
<p>En general, se crea un objeto DAG con <code><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify()</a></code> y se traza con <code><a href="https://r-causal.github.io/ggdag/reference/ggdag.html">ggdag()</a></code> o <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>. La sintaxis para crear un DAG en <code><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify()</a></code> es similar a la que se utiliza cuando se crean modelos con <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> o <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>: construir sistemas de fórmulas que indican las relaciones entre los nodos. Por ejemplo, en el DAG de abajo, <code>y</code> está causado por <code>x</code>, <code>a</code> y <code>b</code> (<code>y ~ x + a + b</code>), y <code>x</code> está causado por <code>a</code> y <code>b</code> (<code>x ~ a + b</code>), lo que hace que <code>a</code> y <code>b</code> sean confundidores.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/ggdag">ggdag</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">simple_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  <span class="va">x</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># theme_dag() puts the plot on a white background without axis labels</span></span>
<span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/ggdag.html">ggdag</a></span><span class="op">(</span><span class="va">simple_dag</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html">theme_dag</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/build-simple-dag-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>Basic DAG built with </figcaption></figure>
</div>
</div>
</div>
<p>Establecer <code>x</code> e <code>y</code> como variables de exposición y resultado es opcional si desea un gráfico simple, pero si los establece, puede colorear los puntos según el estado del nodo:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/status-dag-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>DAG with nodes colored by status</figcaption></figure>
</div>
</div>
</div>
<p>Observe como la disposición es diferente en ambos grafos. Por defecto, <code><a href="https://r-causal.github.io/ggdag/reference/ggdag.html">ggdag()</a></code> posiciona los nodos aleatoriamente cada vez usando un algoritmo de grafo. Puedes cambiar el algoritmo usando el argumento <code>layout</code>: <code>ggdag(simple_dag, layout = "nicely")</code>. Puedes ver una lista completa de posibles algoritmos ejecutando <code>?layout_tbl_graph_igraph</code> en la consola.</p>
<p>Alternativamente, puedes especificar tus propias coordenadas para que los nodos se posicionen siempre en el mismo lugar. Hazlo con el argumento <code>coords</code> en <code><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simple_dag_with_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  <span class="va">x</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">2</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/coords-dag-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>DAG with manual coordinates</figcaption></figure>
</div>
</div>
</div>
<p>Los nombres de las variables que utilices no tienen por qué limitarse a <code>x</code>, <code>y</code> y otras letras minúsculas. Puedes usar los nombres que quieras, siempre que no haya espacios.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">dag_with_var_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">outcome</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">confounder1</span> <span class="op">+</span> <span class="va">confounder2</span>,</span>
<span>  <span class="va">treatment</span> <span class="op">~</span> <span class="va">confounder1</span> <span class="op">+</span> <span class="va">confounder2</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"treatment"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"outcome"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/plot-name-dag-1.png" style="width:80.0%;height:80.0%" class="figure-img"></p>
<figcaption>DAG with node names</figcaption></figure>
</div>
</div>
</div>
<p>Sin embargo, a menos que utilice nombres muy cortos, es probable que el texto no quepa dentro de los nodos. Para evitar esto, puede añadir etiquetas a los nodos usando el argumento <code>labels</code> en <code><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify()</a></code>. Trace las etiquetas estableciendo <code>use_labels = "label"</code> en <code><a href="https://r-causal.github.io/ggdag/reference/ggdag.html">ggdag()</a></code>. Puede desactivar el texto en los nodos con <code>text = FALSE</code> en <code><a href="https://r-causal.github.io/ggdag/reference/ggdag.html">ggdag()</a></code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">simple_dag_with_coords_and_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  <span class="va">x</span> <span class="op">~</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome"</span>, x <span class="op">=</span> <span class="st">"Treatment"</span>, </span>
<span>             a <span class="op">=</span> <span class="st">"Confounder 1"</span>, b <span class="op">=</span> <span class="st">"Confounder 2"</span><span class="op">)</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, a <span class="op">=</span> <span class="fl">2</span>, b <span class="op">=</span> <span class="fl">2</span>, y <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">2</span>, a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">3</span>, y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as
of ggplot2 3.3.4.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/plot-label-dag-1.png" class="img-fluid figure-img" style="width:55.0%"></p>
<figcaption>DAG with node labels</figcaption></figure>
</div>
</div>
</div>
</section><section id="encontrar-caminos-y-conjuntos-de-ajuste-con-r" class="level2" data-number="18.4"><h2 data-number="18.4" class="anchored" data-anchor-id="encontrar-caminos-y-conjuntos-de-ajuste-con-r">
<span class="header-section-number">18.4</span> Encontrar caminos y conjuntos de ajuste con R</h2>
<p>R también puede realizar análisis sobre objetos DAG. Por ejemplo, podemos encontrar todas las implicaciones comprobables del DAG utilizando la función <code><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies()</a></code> del paquete <strong>dagitty</strong>. Para este DAG sencillo, sólo hay una: “a” debe ser independiente de “b”. Si tuviéramos un conjunto de datos con columnas para cada una de estas variables, podríamos comprobar si esto es cierto ejecutando <code>cor(a, b)</code> para ver si ambas están relacionadas.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.dagitty.net">dagitty</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">simple_dag</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>a _||_ b</code></pre>
</div>
</div>
<p>También podemos encontrar todos los caminos entre <code>x</code> y <code>y</code> usando la función <code><a href="https://rdrr.io/pkg/dagitty/man/paths.html">paths()</a></code> del paquete <strong>dagitty</strong>. Podemos ver que hay tres caminos abiertos entre <code>x</code> y <code>y</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/paths.html">paths</a></span><span class="op">(</span><span class="va">simple_dag</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$paths
[1] "x -&gt; y"      "x &lt;- a -&gt; y" "x &lt;- b -&gt; y"

$open
[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
<p>La primera ruta abierta está bien -queremos una única relación conectada <em>d</em> entre el tratamiento y el resultado- pero las otras dos indican que hay confusión entre <code>a</code> y <code>b</code>. Podemos ver cuáles son cada uno de estos caminos con la función <code><a href="https://r-causal.github.io/ggdag/reference/paths.html">ggdag_paths()</a></code> del paquete <strong>ggdag</strong>:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/plot-dag-paths-1.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>All possible paths between and </figcaption></figure>
</div>
</div>
</div>
<p>En lugar de listar todos los caminos posibles e identificar las puertas traseras a mano, puedes usar la función <code><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets()</a></code> del paquete <strong>dagitty</strong> para encontrar programáticamente todos los nodos que necesitan ser ajustados. Aquí vemos que tanto <code>a</code> como <code>b</code> necesitan ser controlados para aislar la relación <code>x -&gt; y</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">simple_dag</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ a, b }</code></pre>
</div>
</div>
<p>También puede visualizar los conjuntos de ajustes con <code><a href="https://r-causal.github.io/ggdag/reference/adjustment_sets.html">ggdag_adjustment_set()</a></code> en el paquete <strong>ggdag</strong>. Asegúrese de establecer <code>shadow = TRUE</code> para dibujar las flechas que salen de los nodos ajustados-por defecto, no se incluyen.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/adjustment_sets.html">ggdag_adjustment_set</a></span><span class="op">(</span><span class="va">simple_dag_with_coords</span>, shadow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html">theme_dag</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu">scale_color_grey</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/plot-adjustment-sets-1.png" class="img-fluid figure-img" style="width:55.0%"></p>
<figcaption>Adjustment set for DAG</figcaption></figure>
</div>
</div>
</div>
<p>R encontrará conjuntos de ajustes mínimamente suficientes, que incluyen el menor número de ajustes necesarios para cerrar todas las puertas traseras entre <code>x</code> y <code>y</code>. En este ejemplo DAG sólo había un conjunto de variables (<code>a</code> y <code>b</code>), pero en otras situaciones podría haber muchos conjuntos posibles, o ninguno si el efecto causal no es identificable.</p>
</section></section><section id="ajustes" class="level1" data-number="19"><h1 data-number="19">
<span class="header-section-number">19</span> Ajustes</h1>
<p>A lo largo de este capítulo, hemos hablado sobre cómo ajustar para confusores para cerrar las vías de atrás, pero hasta ahora no hemos explorado cómo hacer realmente estos ajustes. No hay un método correcto único para ajustar para los nodos. Matemáticamente, el ajuste significa eliminar la variación que proviene de los confusores fuera de los nodos de tratamiento y control. Por ejemplo, en el DAG en la Figura @ref(fig:money-votes-simple), eliminamos el efecto de Calidad del candidato de Dinero recaudado, eliminamos el efecto de Calidad del candidato de Votos totales, y luego comparamos el efecto no confundido de Dinero recaudado en Votos totales. Podemos tener en cuenta el efecto de Calidad del candidato estratificando nuestra muestra en candidatos de alta y baja calidad, ejecutando una regresión que incluya Calidad del candidato como covariable, encontrando pares emparejados en los datos que tengan valores similares de calidad, o ponderando las observaciones por calidad. En esta sección, repasaremos tres formas comunes de realizar ajustes: regresión múltiple, emparejamiento y ponderación por inversa de la probabilidad.</p>
<section id="datos-simulados-sobre-mosquiteros" class="level2" data-number="19.1"><h2 data-number="19.1" class="anchored" data-anchor-id="datos-simulados-sobre-mosquiteros">
<span class="header-section-number">19.1</span> Datos simulados sobre mosquiteros</h2>
<p>En lugar de utilizar un conjunto de datos real de ciencia política, exploraremos diferentes métodos de realizar ajustes utilizando datos creados sobre un programa de desarrollo internacional diseñado para reducir el riesgo de malaria utilizando mosquiteros. Los mismos métodos y principios se aplican al análisis utilizando datos reales, pero es imposible conocer el verdadero efecto causal preexistente en datos observacionales reales, por lo que no hay forma de comparar las estimaciones con la verdad. Sin embargo, como estos datos son simulados, conocemos la verdad (hipotética): el uso de mosquiteros causa que el riesgo de malaria disminuya en 10 puntos, en promedio.</p>
<p>Los investigadores están interesados en si el uso de mosquiteros disminuye el riesgo de contraer malaria de un individuo. Han recopilado datos de 1,752 hogares en un país no especificado y tienen variables relacionadas con factores ambientales, salud individual y características del hogar. Además, este país tiene un programa gubernamental especial que proporciona mosquiteros gratuitos a los hogares que cumplen con requisitos específicos: para calificar para el programa, debe haber más de 4 miembros en el hogar y el ingreso mensual del hogar debe ser inferior a $700 al mes. Los hogares no están automáticamente inscritos en el programa, y muchos no lo utilizan. Los datos no son experimentales: los investigadores no tienen control sobre quién usa mosquiteros, y los hogares individuales toman sus propias decisiones sobre si solicitar mosquiteros gratuitos o comprar sus propios mosquiteros, así como sobre si utilizan los mosquiteros si los tienen.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mosquito_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/dagify.html">dagify</a></span><span class="op">(</span></span>
<span>  <span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">temperature</span> <span class="op">+</span> <span class="va">resistance</span>,</span>
<span>  <span class="va">net</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">temperature</span> <span class="op">+</span> <span class="va">eligible</span> <span class="op">+</span> <span class="va">household</span>,</span>
<span>  <span class="va">eligible</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">household</span>,</span>
<span>  <span class="va">health</span> <span class="op">~</span> <span class="va">income</span>,</span>
<span>  exposure <span class="op">=</span> <span class="st">"net"</span>,</span>
<span>  outcome <span class="op">=</span> <span class="st">"malaria_risk"</span>,</span>
<span>  coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>malaria_risk <span class="op">=</span> <span class="fl">7</span>, net <span class="op">=</span> <span class="fl">3</span>, income <span class="op">=</span> <span class="fl">4</span>, health <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                      temperature <span class="op">=</span> <span class="fl">6</span>, resistance <span class="op">=</span> <span class="fl">8.5</span>, eligible <span class="op">=</span> <span class="fl">2</span>, household <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>malaria_risk <span class="op">=</span> <span class="fl">2</span>, net <span class="op">=</span> <span class="fl">2</span>, income <span class="op">=</span> <span class="fl">3</span>, health <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      temperature <span class="op">=</span> <span class="fl">3</span>, resistance <span class="op">=</span> <span class="fl">2</span>, eligible <span class="op">=</span> <span class="fl">3</span>, household <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>malaria_risk <span class="op">=</span> <span class="st">"Risk of malaria"</span>, net <span class="op">=</span> <span class="st">"Mosquito net"</span>, income <span class="op">=</span> <span class="st">"Income"</span>,</span>
<span>             health <span class="op">=</span> <span class="st">"Health"</span>, temperature <span class="op">=</span> <span class="st">"Nighttime temperatures"</span>, </span>
<span>             resistance <span class="op">=</span> <span class="st">"Insecticide resistance"</span>,</span>
<span>             eligible <span class="op">=</span> <span class="st">"Eligible for program"</span>, household <span class="op">=</span> <span class="st">"Number in household"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/status.html">ggdag_status</a></span><span class="op">(</span><span class="va">mosquito_dag</span>, use_labels <span class="op">=</span> <span class="st">"label"</span>,  </span>
<span>            label_size <span class="op">=</span> <span class="fl">2.5</span>, text <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html">theme_dag</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="va">color_dag</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/plot-mosquito-dag-fake-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/mosquito-dag-plain.jpg" style="width:80.0%;height:150.0%" class="figure-img"></p>
<figcaption>DAG for the effect of a hypothetical mosquito net program on malaria risk</figcaption></figure>
</div>
</div>
</div>
<p>El gráfico causal de la figura (fig:mosquito-dag-plain) esboza la relación completa entre el uso de mosquiteras y el riesgo de paludismo. Cada nodo del DAG es una columna del conjunto de datos recopilados por los investigadores, e incluye lo siguiente:</p>
<ul>
<li><p>Riesgo de paludismo (<code>malaria_risk</code>): La probabilidad de que alguien en el hogar se infecte de malaria. Se mide en una escala de 0-100, en la que los valores más altos indican un mayor riesgo.</p></li>
<li><p>Mosquitera (<code>net</code> y <code>net_num</code>): Variable binaria que indica si el hogar utilizó mosquiteras.</p></li>
<li><p>Elegible para el programa (<code>eligible</code>): Variable binaria que indica si el hogar es elegible para el programa de mosquiteros gratuitos.</p></li>
<li><p>Ingresos (<code>ingresos</code>): Los ingresos mensuales del hogar, en dólares estadounidenses.</p></li>
<li><p>Temperatura nocturna (<code>temperature</code>): La temperatura media nocturna, en grados Celsius.</p></li>
<li><p>Salud (<code>health</code>): Estado de salud autodeclarado en el hogar. Se mide en una escala de 0 a 100. Los valores más altos indican mejor salud.</p></li>
<li><p>Número de personas en el hogar (<code>hogar</code>): Número de personas que viven en el hogar.</p></li>
<li><p>Resistencia a los insecticidas (<code>resistencia</code>): Algunas cepas de mosquitos son más resistentes a los insecticidas y, por tanto, presentan un mayor riesgo de infectar a las personas con malaria. Se mide en una escala de 0 a 100, en la que los valores más altos indican una mayor resistencia.</p></li>
</ul>
<p>Según el DAG, el riesgo de paludismo depende de los ingresos, las temperaturas, la salud, la resistencia a los insecticidas y el uso de mosquiteras. Las personas que viven en regiones más cálidas, tienen menos ingresos, peor salud, están rodeadas de mosquitos con gran resistencia a los insecticidas y no utilizan mosquiteras corren más riesgo de contraer el paludismo que las que no lo hacen. El uso de mosquiteras depende de los ingresos, las temperaturas nocturnas, la salud, el número de personas que viven en la casa y la posibilidad de acogerse al programa de mosquiteras gratuitas. Las personas que viven en zonas con temperaturas nocturnas más frescas, tienen ingresos más altos, gozan de mejor salud, tienen más personas en casa y reúnen los requisitos para recibir mosquiteros gratuitos del gobierno tienen más probabilidades de utilizar mosquiteros con regularidad que las que no los tienen. El DAG también muestra que la elegibilidad para el programa de mosquiteras gratuitas está causada por los ingresos y el tamaño del hogar, ya que los hogares deben cumplir unos umbrales específicos para poder optar a ellas.</p>
<p>Podemos cargar los datos y utilizar <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> para ver las primeras observaciones de cada columna:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mosquito_nets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"Bases/mosquito_nets.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">mosquito_nets</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,752
Columns: 10
$ id           &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
$ net          &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, FALS…
$ net_num      &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, …
$ malaria_risk &lt;dbl&gt; 33, 42, 80, 34, 44, 25, 19, 35, 32, 40, 30, 14, 31, 34, 2…
$ income       &lt;dbl&gt; 781, 974, 502, 671, 728, 1050, 1146, 1093, 1037, 828, 889…
$ health       &lt;dbl&gt; 56, 57, 15, 20, 17, 48, 65, 75, 60, 36, 75, 62, 42, 53, 9…
$ household    &lt;dbl&gt; 2, 4, 3, 5, 5, 1, 3, 5, 3, 3, 6, 3, 4, 3, 1, 5, 2, 1, 2, …
$ eligible     &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FA…
$ temperature  &lt;dbl&gt; 21.1, 26.5, 25.6, 21.3, 19.2, 25.3, 27.4, 29.8, 27.6, 21.…
$ resistance   &lt;dbl&gt; 59, 73, 65, 46, 54, 34, 45, 65, 55, 54, 33, 39, 37, 53, 3…</code></pre>
</div>
</div>
</section><section id="verificar-las-independencias-condicionales" class="level2" data-number="19.2"><h2 data-number="19.2" class="anchored" data-anchor-id="verificar-las-independencias-condicionales">
<span class="header-section-number">19.2</span> Verificar las independencias condicionales</h2>
<p>Antes de proceder a identificar la relación causal entre el uso de mosquiteras y el riesgo de malaria, primero debemos comprobar si las relaciones definidas por nuestro DAG reflejan la realidad de los datos. Recordemos que la separación <em>d</em> implica que los nodos son estadísticamente independientes entre sí y no transfieren información asociacional. Si dibujamos el DAG de la Figura @ref(fig:mosquito-dag-plain) en DAGitty, o si ejecutamos <code><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies()</a></code> en R, podemos ver una lista de todas las independencias condicionales implícitas.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">mosquito_dag</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>elgb _||_ hlth | incm
elgb _||_ mlr_ | hlth, incm, net, tmpr
elgb _||_ rsst
elgb _||_ tmpr
hlth _||_ hshl
hlth _||_ rsst
hlth _||_ tmpr
hshl _||_ incm
hshl _||_ mlr_ | hlth, incm, net, tmpr
hshl _||_ rsst
hshl _||_ tmpr
incm _||_ rsst
incm _||_ tmpr
net _||_ rsst
rsst _||_ tmpr</code></pre>
</div>
</div>
<p>En aras del espacio, no vamos a verificar todas estas independencias implícitas, pero podemos probar algunas de ellas:</p>
<ul>
<li>
<p>$ salud debe ser independiente del número de personas en cada hogar. En los datos, las dos variables no deberían estar correlacionadas. Y así es:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mosquito_nets</span><span class="op">$</span><span class="va">health</span>, <span class="va">mosquito_nets</span><span class="op">$</span><span class="va">household</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.785337e-05</code></pre>
</div>
</div>
</li>
<li>
<p><span class="math inline">\(\text{Income} \perp \text{Resistencia a los insecticidas}\)</span>: Los ingresos deberían ser independientes de la resistencia a los insecticidas. Esto es cierto de nuevo:</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">mosquito_nets</span><span class="op">$</span><span class="va">income</span>, <span class="va">mosquito_nets</span><span class="op">$</span><span class="va">resistance</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01371297</code></pre>
</div>
</div>
</li>
<li><p><span class="math inline">\(\text{Malaria risk} \perp \text{Household members}\ |\ \text{Health, Income, Bet net use, Temperature}\)</span>: El riesgo de malaria debería ser independiente del número de miembros del hogar si los niveles de salud, ingresos, uso de mosquiteras y temperatura nocturna son similares. No podemos utilizar <code><a href="https://rdrr.io/r/stats/cor.html">cor()</a></code> para probar esta implicación, ya que hay muchas variables implicadas, pero podemos utilizar un modelo de regresión para comprobar si el número de miembros del hogar está relacionado de forma significativa con el riesgo de malaria. No es significativa (<span class="math inline">\(t = -0,17\)</span>, <span class="math inline">\(p = 0,863\)</span>), lo que significa que ambas son independientes, como cabía esperar.</p></li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">household</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">net</span> <span class="op">+</span> <span class="va">temperature</span>, </span>
<span>   data <span class="op">=</span> <span class="va">mosquito_nets</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  term        estimate std.error statistic   p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)  76.2      0.966      78.9   0        
2 household    -0.0155   0.0893     -0.173 8.63e-  1
3 health        0.148    0.0107     13.9   9.75e- 42
4 income       -0.0751   0.00104   -72.6   0        
5 netTRUE     -10.4      0.266     -39.2   2.63e-241
6 temperature   1.01     0.0310     32.5   1.88e-181</code></pre>
</div>
</div>
<p>Tras comprobar todas las demás dependencias condicionales, podemos saber si nuestro DAG capta la realidad del sistema completo de factores que influyen en el uso de mosquiteras y el riesgo de paludismo. Si hay correlaciones sustanciales y significativas entre nodos que deberían ser independientes, es probable que haya un problema con la especificación del DAG. Vuelva a la teoría de cómo se generan los fenómenos y refine más el DAG.</p>
</section><section id="encontrar-el-conjunto-de-ajuste" class="level2" data-number="19.3"><h2 data-number="19.3" class="anchored" data-anchor-id="encontrar-el-conjunto-de-ajuste">
<span class="header-section-number">19.3</span> Encontrar el conjunto de ajuste</h2>
<p>Hay un camino directo entre el uso de mosquiteras y el riesgo de malaria, pero el efecto no está identificado causalmente debido a otros caminos abiertos. Podemos hacer una lista de todos los caminos y encontrar qué caminos abiertos tienen flechas que apuntan hacia atrás en el nodo del mosquitero (ejecute <code>paths(mosquito_dag)</code> para ver estos resultados), o podemos dejar que R encuentre los conjuntos de ajuste apropiados automáticamente:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">mosquito_dag</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{ health, income, temperature }</code></pre>
</div>
</div>
<p>Basándonos en las relaciones entre todos los nodos del DAG, basta con ajustar por salud, ingresos y temperatura para cerrar todas las puertas traseras e identificar la relación entre el uso de mosquiteras y el riesgo de paludismo (véase la Figura @ref(fig:mosquito-dag-adjusted)). Es importante destacar que no tenemos que preocuparnos por ninguno de los nodos relacionados con el programa gubernamental de mosquiteras gratuitas, ya que esos nodos no están <em>d</em> conectados con el riesgo de paludismo. Sólo debemos preocuparnos por las relaciones de confusión.</p>
<p>Podemos confirmar esto graficamente con <code><a href="https://r-causal.github.io/ggdag/reference/adjustment_sets.html">ggdag_adjustment_set()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://r-causal.github.io/ggdag/reference/adjustment_sets.html">ggdag_adjustment_set</a></span><span class="op">(</span><span class="va">mosquito_dag</span>, shadow <span class="op">=</span> <span class="cn">TRUE</span>, label_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                     use_labels <span class="op">=</span> <span class="st">"label"</span>, text <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/ggdag/reference/theme_dag_blank.html">theme_dag</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html">scale_color_grey</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Adjustment set to identify the relationship between mosquito net use and malaria risk</figcaption></figure>
</div>
</div>
</div>
</section><section id="estimación-ingenua-no-ajustada" class="level2" data-number="19.4"><h2 data-number="19.4" class="anchored" data-anchor-id="estimación-ingenua-no-ajustada">
<span class="header-section-number">19.4</span> Estimación ingenua no ajustada</h2>
<p>Como punto de partida para los demás enfoques de ajuste que probaremos, podemos ver primero cuál es la relación entre el uso de mosquiteras y el riesgo de paludismo en ausencia de cualquier ajuste. Si creamos un diagrama de caja de la distribución del riesgo de paludismo entre las personas que utilizan mosquiteras y las que no, veremos que el riesgo medio es sustancialmente menor entre las que utilizan mosquiteras (véase la Figura @ref(fig:naive-boxplots)).</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mosquito_nets</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">net</span>, y <span class="op">=</span> <span class="va">malaria_risk</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html">theme_cowplot</a></span><span class="op">(</span>font_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/naive-boxplots-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption>Distribution of malaria risk across those who did and did not use mosquito nets</figcaption></figure>
</div>
</div>
</div>
<p>Podemos aplicar un modelo de regresión simple para medir la diferencia media exacta:</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">mosquito_nets</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">texreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/texreg/man/screenreg.html">screenreg</a></span><span class="op">(</span><span class="va">model_naive</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================
             Model 1    
------------------------
(Intercept)    41.94 ***
               (0.40)   
netTRUE       -16.33 ***
               (0.65)   
------------------------
R^2             0.27    
Adj. R^2        0.27    
Num. obs.    1752       
========================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Según este modelo, parece que el uso de mosquiteras se asocia con una disminución de 16 puntos en el riesgo de paludismo. Sin embargo, este <em>no</em> es el efecto causal. Se trata de un caso en el que correlación no equivale a causalidad. Otros factores como los ingresos, la salud y las temperaturas confunden la relación entre el uso del mosquitero y el riesgo.</p>
</section><section id="regresión" class="level2" data-number="19.5"><h2 data-number="19.5" class="anchored" data-anchor-id="regresión">
<span class="header-section-number">19.5</span> Regresión</h2>
<p>Como ya está familiarizado con los modelos de regresión múltiple, una forma rápida y fácil de intentar ajustar los factores de confusión es incluirlos como covariables en una regresión lineal. A primera vista, esto tiene un sentido intuitivo: el objetivo del ajuste es comparar los nodos de tratamiento y resultado con los mismos valores de los distintos factores de confusión, y el objetivo de la regresión múltiple es explicar la variación en el resultado manteniendo constantes las distintas variables explicativas. <strong>Para que el ajuste basado en la regresión funcione, las relaciones entre todos los nodos de tratamiento, resultado y factores de confusión</strong> <em>deben ser lineales</em>, lo que es difícil de probar y verificar con datos observacionales reales. Casi siempre es mejor utilizar una de las otras técnicas de ajuste descritas a continuación (emparejamiento o ponderación de probabilidad inversa), ya que estos métodos no se basan en el supuesto de linealidad.</p>
<p>Con esa <em>gran</em> salvedad, podemos ajustar nuestras puertas traseras incluyéndolas en un modelo de regresión:</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_regression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">temperature</span> <span class="op">+</span> <span class="va">health</span>, </span>
<span>                       data <span class="op">=</span> <span class="va">mosquito_nets</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">texreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/texreg/man/screenreg.html">screenreg</a></span><span class="op">(</span><span class="va">model_regression</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================
             Model 1    
------------------------
(Intercept)    76.16 ***
               (0.93)   
netTRUE       -10.44 ***
               (0.26)   
income         -0.08 ***
               (0.00)   
temperature     1.01 ***
               (0.03)   
health          0.15 ***
               (0.01)   
------------------------
R^2             0.89    
Adj. R^2        0.88    
Num. obs.    1752       
========================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Basándonos en estos resultados, el uso de un mosquitero *causa** una disminución de 10.44 puntos en el riesgo de malaria, en promedio. Tenga en cuenta que, dado que hemos ajustado por variables de confusión, ahora podemos justificadamente utilizar un lenguaje causal en lugar de simplemente hablar de asociaciones.</p>
</section><section id="matching-emparejamiento" class="level2" data-number="19.6"><h2 data-number="19.6" class="anchored" data-anchor-id="matching-emparejamiento">
<span class="header-section-number">19.6</span> Matching (Emparejamiento)</h2>
<p>El principal problema al utilizar datos observacionales en lugar de experimentales es que las personas que usaron un mosquitero lo hicieron sin ser asignadas a un grupo de tratamiento. Las características individuales llevaron a las personas a autoseleccionarse en el tratamiento, lo que hace que las personas que usaron mosquiteros sean fundamentalmente diferentes de aquellas que no lo hicieron. Gracias al DAG, sabemos muchos de los factores que llevaron a las personas a elegir usar redes: ingresos, salud y temperatura. Si pudiéramos agrupar observaciones similares entre sí en ingresos, salud y temperatura, pero diferentes en su uso de mosquiteros, podríamos simular grupos de tratamiento y control experimentales y calcular, argumentablemente, un efecto causal más preciso, ya que estamos encontrando la estimación entre grupos comparables.</p>
<p>Si bien el emparejamiento con puntajes de propensión es popular, puede causar problemas cuando se utiliza para la identificación causal. Sin embargo, existen alternativas. Una técnica común es encontrar coincidencias que minimicen la distancia entre los diferentes confusores para cada observación.</p>
<p>Para ilustrar este concepto de manera muy breve, considera un modelo causal donde la edad y la educación son los únicos confusores de la relación entre un tratamiento y un resultado. Algunas de las observaciones se autoseleccionaron en el tratamiento, mientras que el resto no lo hicieron. El Panel A en la Figura @ref(fig:matching-example) muestra la distribución del tratamiento autoseleccionado en diferentes valores de edad y educación. Hay algunos patrones notables: solo una observación tratada tiene más de 25 años de educación, y solo una tiene menos de 15 años. Si queremos crear grupos de tratamiento y control sintéticos a partir de estos datos, no tendría sentido comparar la única observación tratada altamente educada con observaciones no tratadas con bajos niveles de educación, ya que las dos observaciones tienen niveles tan diferentes de educación. Idealmente, queremos encontrar la observación no tratada altamente educada más cercana y similar y usar esa como la comparación con la única observación tratada altamente educada.</p>
<p>Si podemos encontrar una colección de observaciones no tratadas que estén cerca en distancia a las observaciones tratadas, podemos crear un conjunto de observaciones tratadas y no tratadas emparejadas y equilibradas. El Panel B en la Figura @ref(fig:matching-example) muestra cada una de las parejas más cercanas de observaciones tratadas y no tratadas. Podemos desechar cualquier observación no tratada no emparejada y solo usar el conjunto emparejado para hacer nuestra inferencia causal, ya que ahora ostensiblemente tenemos grupos de tratamiento y control comparables. Hay múltiples formas de medir esta distancia: la distancia de Mahalanobis y la distancia euclidiana son comunes, pero no los únicos métodos. También hay múltiples métodos para definir parejas. En la Figura @ref(fig:matching-example), cada observación tratada se empareja con una única observación no tratada, pero también es posible permitir el duplicado y el triplicado de emparejamientos. El ejemplo en la Figura @ref(fig:matching-example) minimiza la distancia entre dos dimensiones de confusores (edad y educación), pero puedes usar tantos confusores como sea necesario para crear pares emparejados.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/matching-example.png" class="img-fluid figure-img" width="692"></p>
<figcaption>Matching based on nearest neighbor Mahalanobis distance</figcaption></figure>
</div>
</div>
</div>
<p>Podemos utilizar el emparejamiento para ajustar los factores de confusión en nuestro DAG de mosquitera y riesgo de malaria. La función <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit()</a></code> del paquete <strong>MatchIt</strong> de R proporciona muchos métodos de emparejamiento diferentes, incluido el emparejamiento Mahalanobis del vecino más cercano. No existe un único método de comparación óptimo, por lo que debe jugar con las distintas opciones de los argumentos <code>method</code> y <code>distance</code>. El argumento <code>replace = TRUE</code> permite emparejar observaciones tratadas con más de una observación no tratada.</p>
<p>La función <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit()</a></code> utiliza una sintaxis familiar basada en fórmulas para definir cómo emparejar la asignación con mosquiteras. Dado que nuestro conjunto de ajustes incluye los ingresos, la temperatura y la salud, utilizamos los tres para crear las correspondencias.</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/">MatchIt</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">net</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">temperature</span> <span class="op">+</span> <span class="va">health</span>, data <span class="op">=</span> <span class="va">mosquito_nets</span>,</span>
<span>                   method <span class="op">=</span> <span class="st">"nearest"</span>, distance <span class="op">=</span> <span class="st">"mahalanobis"</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">matched</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A matchit object
 - method: 1:1 nearest neighbor matching with replacement
 - distance: Mahalanobis
 - number of obs.: 1752 (original), 1117 (matched)
 - target estimand: ATT
 - covariates: income, temperature, health</code></pre>
</div>
</div>
<p>Según el resultado de “emparejado”, las 681 observaciones tratadas (es decir, las que utilizaron mosquiteras) se emparejaron con 439 observaciones no tratadas (es decir, personas con ingresos, temperatura y salud similares, pero que no utilizaron mosquiteras). No se emparejaron 632 observaciones no tratadas, que se descartarán. Si hubiéramos utilizado <code>replace = FALSE</code>, habría habido el mismo número de observaciones tratadas y no tratadas; aquí hay menos observaciones no tratadas porque algunas están duplicadas o triplicadas.</p>
<p>Podemos crear un nuevo marco de datos basado en este emparejamiento con la función <code><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html">match.data()</a></code>. Observe que ahora sólo hay 1.120 filas en lugar de 1.752, ya que descartamos las observaciones no emparejadas. Observe también que hay una nueva columna llamada “pesos”. La función <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html">matchit()</a></code> asigna a los pares de observaciones emparejados distintos pesos en función de lo próximas o distantes que estén las coincidencias, en un intento de controlar la variación en la distancia. Podemos utilizar estas ponderaciones en nuestro modelo de regresión para mejorar nuestra estimación del efecto causal.</p>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mosquito_nets_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kosukeimai.github.io/MatchIt/reference/match.data.html">match.data</a></span><span class="op">(</span><span class="va">matched</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">mosquito_nets_matched</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,117
Columns: 11
$ id           &lt;dbl&gt; 1, 3, 4, 5, 6, 7, 8, 11, 12, 13, 14, 16, 17, 20, 22, 23, …
$ net          &lt;lgl&gt; TRUE, FALSE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE…
$ net_num      &lt;dbl&gt; 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 1, …
$ malaria_risk &lt;dbl&gt; 33, 80, 34, 44, 25, 19, 35, 30, 14, 31, 34, 54, 23, 65, 5…
$ income       &lt;dbl&gt; 781, 502, 671, 728, 1050, 1146, 1093, 889, 1133, 807, 950…
$ health       &lt;dbl&gt; 56, 15, 20, 17, 48, 65, 75, 75, 62, 42, 53, 29, 47, 6, 30…
$ household    &lt;dbl&gt; 2, 3, 5, 5, 1, 3, 5, 6, 3, 4, 3, 5, 2, 6, 4, 3, 7, 3, 3, …
$ eligible     &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…
$ temperature  &lt;dbl&gt; 21.1, 25.6, 21.3, 19.2, 25.3, 27.4, 29.8, 17.4, 18.9, 27.…
$ resistance   &lt;dbl&gt; 59, 65, 46, 54, 34, 45, 65, 33, 39, 37, 53, 55, 32, 38, 4…
$ weights      &lt;dbl&gt; 1.0000000, 0.6402349, 1.0000000, 0.6402349, 1.2804699, 1.…</code></pre>
</div>
</div>
<p>Por último, podemos realizar una regresión utilizando los datos emparejados:</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">mosquito_nets_matched</span>, </span>
<span>                    weights <span class="op">=</span> <span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">texreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/texreg/man/screenreg.html">screenreg</a></span><span class="op">(</span><span class="va">model_matched</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================
             Model 1    
------------------------
(Intercept)    36.09 ***
               (0.60)   
netTRUE       -10.48 ***
               (0.76)   
------------------------
R^2             0.14    
Adj. R^2        0.14    
Num. obs.    1117       
========================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Basándonos en estos resultados, el uso de un mosquitero <strong>causa</strong> una disminución de 10.49 puntos en el riesgo de malaria, en promedio. Una vez más, podemos usar lenguaje causal ahora porque ajustamos por confusores al emparejar, identificando así la vía causal entre el uso de mosquiteros y el riesgo de malaria.</p>
</section><section id="inverse-probability-weighting" class="level2" data-number="19.7"><h2 data-number="19.7" class="anchored" data-anchor-id="inverse-probability-weighting">
<span class="header-section-number">19.7</span> Inverse probability weighting</h2>
<p>Una desventaja de usar el emparejamiento es que descartamos mucha información: las observaciones no emparejadas se descartan y nuestro tamaño de muestra puede reducirse significativamente. El emparejamiento también tiende a ser altamente discreto, ya que cada observación tratada debe emparejarse con una (o más) observaciones no tratadas. Vuelve a mirar el Panel B en la Figura @ref(fig:matching-example) y observa que algunas observaciones no tratadas están realmente muy cerca de las observaciones tratadas, pero aún se descartan porque fueron superadas por observaciones que tienen una distancia ligeramente menor.</p>
<p>En lugar de desechar datos potencialmente útiles, podemos usar otros métodos para crear coincidencias que sean menos discretas y más informativas. Un método común en epidemiología y biostadística es la ponderación por probabilidad inversa (IPW). Bajo IPW, cada observación se asigna un peso en función de qué tan bien su asignación real al tratamiento coincide con la probabilidad predicha de tratamiento, y esos pesos se utilizan luego en un modelo de regresión para estimar el efecto causal del tratamiento sobre el resultado.</p>
<p>Podemos ilustrar este proceso con el ejemplo de educación y edad de la Figura @ref(fig:matching-example). En lugar de emparejar, usamos regresión logística para crear puntajes de propensión para el tratamiento:</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">edu_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"Bases/edu_age.csv"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>treatment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">treatment</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 100 Columns: 5
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): treatment
dbl (4): id, treatment_num, education, age

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_treatment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">education</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">edu_age</span>,</span>
<span>                       family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edu_age_propensities</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://broom.tidymodels.org/reference/augment_columns.html">augment_columns</a></span><span class="op">(</span><span class="va">model_treatment</span>, <span class="va">edu_age</span>, </span>
<span>                                               type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>propensity <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Podemos observar algunas filas de los datos para ver estas puntuaciones de propensión. La persona 59 tenía una probabilidad del 14% de autoseleccionarse para el tratamiento dada su educación y edad, pero acabó no haciéndolo, como se predijo. La persona 27, por otro lado, también tenía un 14% de posibilidades de elegir el tratamiento y lo hizo, lo que es un resultado bastante improbable. ¡Esa elección es inesperada!</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">edu_age_propensities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">treatment</span>, <span class="va">education</span>, <span class="va">age</span>, <span class="va">propensity</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">27</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
     id treatment education   age propensity
  &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
1    59 Control        28.9  47.0      0.147
2    27 Treatment      21.7  63.2      0.148</code></pre>
</div>
</div>
<p>Con el emparejamiento, estábamos interesados en emparejar observaciones inesperadas y esperadas; recuerde que necesitábamos encontrar una observación no tratada altamente educada para emparejarla con la única observación tratada altamente educada. Aquí hacemos lo mismo. Las observaciones que tienen pocas probabilidades de recibir tratamiento y luego no lo reciben siguen nuestras expectativas y deberían tener menos peso. Por el contrario, las observaciones que tienen pocas probabilidades de recibir tratamiento y luego <em>lo reciben</em> deberían tener más peso. La ponderación de probabilidad inversa nos permite asignar un valor numérico al carácter inesperado de las observaciones. Utilizamos la siguiente fórmula para calcular las ponderaciones de probabilidad inversa para un efecto medio del tratamiento, donde <span class="math inline">\(\text{Treatment}\)</span> es una variable binaria 0/1.</p>
<p><span class="math display">\[
\frac{\text{Treatment}}{\text{Propensity}} + \frac{1 - \text{Treatment}}{1 - \text{Propensity}}
\]</span></p>
<p>Podemos añadir pesos de probabilidad inversa a nuestras puntuaciones de propensión predichas con <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Compare los valores de <code>ipw</code> para la Persona 59 y 27. Recuerde que la persona 59 tenía una baja probabilidad de seleccionar el tratamiento y no lo hizo, como era de esperar. Su peso de probabilidad inversa es de sólo 1,17. La persona 27, por otro lado, tenía una probabilidad baja de estar en tratamiento y, sin embargo, superó las probabilidades y se unió al tratamiento, en contra de lo esperado. En consecuencia, su peso de probabilidad inversa es de 6,78.</p>
<div class="cell">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">edu_age_ipw</span> <span class="op">&lt;-</span> <span class="va">edu_age_propensities</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ipw <span class="op">=</span> <span class="op">(</span><span class="va">treatment_num</span> <span class="op">/</span> <span class="va">propensity</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">treatment_num</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">propensity</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">edu_age_ipw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">treatment</span>, <span class="va">education</span>, <span class="va">age</span>, <span class="va">propensity</span>, <span class="va">ipw</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">59</span>, <span class="fl">27</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
     id treatment education   age propensity   ipw
  &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
1    59 Control        28.9  47.0      0.147  1.17
2    27 Treatment      21.7  63.2      0.148  6.78</code></pre>
</div>
</div>
<p>Dado que cada observación del conjunto de datos tiene una puntuación de probabilidad inversa, no necesitamos desechar ningún dato. En su lugar, podemos ponderar cada observación por su puntuación de probabilidad inversa. La figura @ref(fig:ipw-example) muestra el conjunto de datos completo con los puntos ponderados por su IPW. Las observaciones que cumplen las expectativas reciben menos peso que las observaciones que se comportan de forma contraria a las expectativas.</p>
<div class="cell">
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">edu_age_ipw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">education</span>, y <span class="op">=</span> <span class="va">age</span>, </span>
<span>                        color <span class="op">=</span> <span class="va">treatment</span>, size <span class="op">=</span> <span class="va">ipw</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.3_files/figure-html/unnamed-chunk-17-1.png" style="height:50.0%" width="672" class="figure-img"></p>
<figcaption>Observations sized by inverse probability weights</figcaption></figure>
</div>
</div>
</div>
<p>Podemos ajustar los factores de confusión en nuestro ejemplo del mosquitero y el riesgo de paludismo utilizando la ponderación de probabilidad inversa. En primer lugar, utilizamos la regresión logística para predecir la propensión a utilizar un mosquitero utilizando los ingresos, la temperatura y la salud. A continuación, utilizamos las puntuaciones de propensión para calcular las ponderaciones de probabilidad inversa mediante esta fórmula:</p>
<p><span class="math display">\[
\frac{\text{Mosquito net}}{\text{Propensity}} + \frac{1 - \text{Mosquito net}}{1 - \text{Propensity}}
\]</span></p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_mosquito_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">net</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">temperature</span> <span class="op">+</span> <span class="va">health</span>, </span>
<span>                          data <span class="op">=</span> <span class="va">mosquito_nets</span>,</span>
<span>                          family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mosquito_nets_ipw</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://broom.tidymodels.org/reference/augment_columns.html">augment_columns</a></span><span class="op">(</span><span class="va">model_mosquito_net</span>,</span>
<span>                                            <span class="va">mosquito_nets</span>,</span>
<span>                                            type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>propensity <span class="op">=</span> <span class="va">.fitted</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ipw <span class="op">=</span> <span class="op">(</span><span class="va">net_num</span> <span class="op">/</span> <span class="va">propensity</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">net_num</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">propensity</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora que tenemos pesos de probabilidad inversa, podemos utilizarlos en una regresión:</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_ipw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">mosquito_nets_ipw</span>, </span>
<span>                weights <span class="op">=</span> <span class="va">ipw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">texreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/texreg/man/screenreg.html">screenreg</a></span><span class="op">(</span><span class="va">model_ipw</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
========================
             Model 1    
------------------------
(Intercept)    39.68 ***
               (0.47)   
netTRUE       -10.13 ***
               (0.66)   
------------------------
R^2             0.12    
Adj. R^2        0.12    
Num. obs.    1752       
========================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
<p>Según este modelo IPW, el uso de mosquiteras <em>causa</em> una disminución media de 10,13 puntos en el riesgo de paludismo. Una vez más, podemos utilizar con seguridad un lenguaje causal porque hemos identificado la vía causal entre el uso de mosquiteras y el riesgo de paludismo teniendo en cuenta los factores de confusión en las ponderaciones de probabilidad inversas.</p>
</section><section id="comparando-todos-los-métodos" class="level2" data-number="19.8"><h2 data-number="19.8" class="anchored" data-anchor-id="comparando-todos-los-métodos">
<span class="header-section-number">19.8</span> Comparando todos los métodos</h2>
<p>Ahora que hemos ejecutado varios modelos de regresión que ajustan por confusores de diferentes maneras, podemos comparar los resultados. La estimación ingenua de −16 parece definitivamente ser una sobreestimación: después de ajustar con regresión, emparejamiento y ponderación por probabilidad inversa, el efecto causal de usar un mosquitero en el riesgo de malaria es consistentemente alrededor de −10. Suponiendo que nuestro DAG es correcto, encontramos con éxito un efecto causal a partir de datos no experimentales, observacionales.</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">texreg</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/texreg/man/screenreg.html">screenreg</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model_naive</span>, <span class="va">model_regression</span>, <span class="va">model_matched</span>, <span class="va">model_ipw</span><span class="op">)</span>,</span>
<span>                  custom.model.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Naive"</span>, <span class="st">"Regression"</span>, <span class="st">"Matching"</span>, <span class="st">"IPW"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===============================================================
             Naive        Regression   Matching     IPW        
---------------------------------------------------------------
(Intercept)    41.94 ***    76.16 ***    36.09 ***    39.68 ***
               (0.40)       (0.93)       (0.60)       (0.47)   
netTRUE       -16.33 ***   -10.44 ***   -10.48 ***   -10.13 ***
               (0.65)       (0.26)       (0.76)       (0.66)   
income                      -0.08 ***                          
                            (0.00)                             
temperature                  1.01 ***                          
                            (0.03)                             
health                       0.15 ***                          
                            (0.01)                             
---------------------------------------------------------------
R^2             0.27         0.89         0.14         0.12    
Adj. R^2        0.27         0.88         0.14         0.12    
Num. obs.    1752         1752         1117         1752       
===============================================================
*** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05</code></pre>
</div>
</div>
</section></section><section id="advertencias" class="level1" data-number="20"><h1 data-number="20">
<span class="header-section-number">20</span> Advertencias</h1>
<p>Los DAG, o Grafos Acíclicos Dirigidos, son herramientas poderosas para integrar los aspectos teóricos y filosóficos de tu modelo causal en la estimación estadística. Sin embargo, simplemente construir un DAG no te otorga automáticamente la habilidad de discutir sobre causalidad. Los grafos causales no pueden resolver el desafío fundamental de la inferencia causal; no pueden actuar como máquinas del tiempo que proporcionen información sobre escenarios hipotéticos.</p>
<p>La suposición subyacente en los DAG es que una relación causal puede ser completamente identificada y aislada utilizando solo datos observables. Los críticos a menudo critican este enfoque, conocido como selección en observables, ya que omitir un nodo crucial debido a la no observabilidad puede llevar a estimaciones causales sesgadas, independientemente del método utilizado para aislar las relaciones entre nodos, como el emparejamiento o la ponderación por probabilidad inversa.</p>
<p>Los nodos en los DAG pueden representar variables observables, pero también pueden encapsular fenómenos no observables. Por ejemplo, en la Figura @ref(fig:money-votes-complex), introdujimos un nodo para la historia del distrito electoral, que influye tanto en la dinámica del partido como en las características del distrito. Intentar encapsular la historia completa de un distrito en una sola variable del conjunto de datos es poco factible. Incluso si desglosamos el nodo “historia” en componentes más manejables, como las afiliaciones partidarias de candidatos anteriores o las decisiones sobre los límites del distrito, debemos interpretar con precaución estos nodos más pequeños como representativos de la historia completa del distrito.</p>
<p>A pesar de las críticas, la presencia de nodos no observables en un DAG no excluye su utilidad para aislar e identificar efectos causales. A través de la lógica de d-separación y las flechas direccionales en el DAG, podemos excluir factores no observables, como la historia del distrito en la Figura @ref(fig:money-votes-complex), si están bloqueados por nodos observables, como los nodos de distrito y partido. Si tenemos confianza en la corrección de nuestro DAG y en la suficiencia de estos nodos observables para bloquear la variación no medida, podemos proceder con la estimación de efectos causales. Sin embargo, si la historia no observable de un distrito influye en la recaudación de fondos de campaña o los votos totales a través de vías desbloqueadas, no podemos identificar el efecto causal utilizando solo datos observacionales.</p>
<p>En última instancia, la precisión de tus estimaciones causales depende de la calidad de tu DAG. Omitir nodos de confusión, no poder medirlos o incluir nodos de colisión puede llevar a resultados erróneos. Además, las relaciones entre nodos observables y no observables pueden ser demasiado intrincadas para el ajuste de do-cálculo. Sin completa confianza en la alineación de tu DAG con el proceso generador de datos y la teoría subyacente, y en la suficiencia de los ajustes realizados para identificar relaciones causales, es prudente no depositar una confianza indebida en los resultados.</p>
</section><section id="referencias" class="level1" data-number="21"><h1 data-number="21">
<span class="header-section-number">21</span> Referencias</h1>
<ul>
<li><p>Ross, R.D., Shi, X., Caram, M.E.V. et al.&nbsp;Veridical causal inference using propensity score methods for comparative effectiveness research with medical claims. Health Serv Outcomes Res Method (2020). <a href="https://doi.org/10.1007/s10742-020-00222-8" class="uri">https://doi.org/10.1007/s10742-020-00222-8</a></p></li>
<li><p>Elwert, F. (2013). Graphical Causal Models. In S. L. Morgan (Ed.), <em>Handbook of Causal Analysis for Social Research</em> (pp.&nbsp;245–273). Springer.</p></li>
<li><p>Hernán, M. A., &amp; Robbins, J. M. (2020). <em>Causal Inference: What If</em>. CRC Press.</p></li>
<li><p>Morgan, S. L., &amp; Winship, C. (2007). <em>Counterfactuals and Causal Inference: Methods and Principles for Social Research</em>. Cambridge University Press.</p></li>
<li><p>Pearl, J., Glymour, M., &amp; Jewell, N. P. (2016). <em>Causal Inference in Statistics: A Primer</em>. Wiley.</p></li>
<li><p>Pearl, J., &amp; Mackenzie, D. (2018). <em>The Book of Why: The New Science of Cause and Effect</em>. Basic Books.</p></li>
<li><p>Rohrer, J. M. (2018). Thinking Clearly About Correlations and Causation: Graphical Causal Models for Observational Data. <em>Advances in Methods and Practices in Psychological Science</em>, <em>1</em>(1), 27–42.</p></li>
<li><p>Shalizi, C. R. (2019). <em>Advanced Data Analysis From an Elementary Point of view</em>. <a href="https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/ADAfaEPoV.jpg" class="uri">https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/ADAfaEPoV.jpg</a></p></li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../capitulos/Capítulo3.2.html" class="pagination-link" aria-label="Inferencia causal">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Inferencia causal</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../capitulos/Capítulo3.4.html" class="pagination-link" aria-label="set default theme">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">set default theme</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>This book was built with 💕 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>DataLab for causal inference</p>
</div>
  </div>
</footer>


</body></html>