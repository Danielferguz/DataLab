<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Daniel Fernandez">
<title>14&nbsp; Pasos para estimar causalidad – DataLab for causal inference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../capitulos/Capítulo4.html" rel="next">
<link href="../capitulos/Capítulo3.3.html" rel="prev">
<link href="../cover.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script>
  if (window.location.hostname === "danielferguz.github.io") {
    window.location.replace("https://datalabperu.cloudflareaccess.com/");
  }
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.html">Casualidad vs causalidad</a></li><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.4.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">set default theme</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">DataLab for causal inference</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefacio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introducción</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">capitulos/capitulo1.qmd</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Tipos de estudios de investigación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Diseños de investigación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tareas científicas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tareas descriptivas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Tareas predictivas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo1.6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Tareas explicativas - inferencia causal</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../capitulos/Capítulo2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Capítulo 2: Medidas en epidemiología</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Medidas de Frecuencia</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Medidas de Asociación</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Medidas de Impacto</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo2.4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Entonces: ¿qué es la asociación?</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../capitulos/Capítulo3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Casualidad vs causalidad</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">**Introducción a los fundamentos de los ensayos controlados aleatorios**</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Inferencia causal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introducción</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../capitulos/Capítulo3.4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">set default theme</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">¡¡¡No todo es confusión!!!</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Muestreo</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Introducción a R y Quarto</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Limpieza y manejo de datos en R</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis descriptivos</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de asociación</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis inferencial en ECA</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis inferencial en EO</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis predictivos (diagnóstico)</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis predictivos (Pronóstico)</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Cálculo de tamaño muestral</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de series de tiempo</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis multinivel</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Manejo de datos perdidos</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Análisis de mediación</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Revisiones sistemáticas</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">Evaluación de la certeza de la evidencia</span></span>
  </li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#especificar-una-pregunta-causal" id="toc-especificar-una-pregunta-causal" class="nav-link active" data-scroll-target="#especificar-una-pregunta-causal"><span class="header-section-number">14.1</span> Especificar una pregunta causal</a></li>
  <li><a href="#dibujar-nuestras-suposiciones-usando-un-diagrama-causal" id="toc-dibujar-nuestras-suposiciones-usando-un-diagrama-causal" class="nav-link" data-scroll-target="#dibujar-nuestras-suposiciones-usando-un-diagrama-causal"><span class="header-section-number">14.2</span> Dibujar nuestras suposiciones usando un diagrama causal</a></li>
  <li><a href="#modele-nuestras-suposiciones" id="toc-modele-nuestras-suposiciones" class="nav-link" data-scroll-target="#modele-nuestras-suposiciones"><span class="header-section-number">14.3</span> Modele nuestras suposiciones</a></li>
  <li><a href="#diagnosticar-nuestros-modelos" id="toc-diagnosticar-nuestros-modelos" class="nav-link" data-scroll-target="#diagnosticar-nuestros-modelos"><span class="header-section-number">14.4</span> Diagnosticar nuestros modelos</a></li>
  <li><a href="#estimar-el-efecto-causal" id="toc-estimar-el-efecto-causal" class="nav-link" data-scroll-target="#estimar-el-efecto-causal"><span class="header-section-number">14.5</span> Estimar el efecto causal</a></li>
  <li><a href="#realizar-an%C3%A1lisis-de-sensibilidad-sobre-la-estimaci%C3%B3n-del-efecto." id="toc-realizar-análisis-de-sensibilidad-sobre-la-estimación-del-efecto." class="nav-link" data-scroll-target="#realizar-an%C3%A1lisis-de-sensibilidad-sobre-la-estimaci%C3%B3n-del-efecto."><span class="header-section-number">14.6</span> Realizar análisis de sensibilidad sobre la estimación del efecto.</a></li>
  <li><a href="#referencias" id="toc-referencias" class="nav-link" data-scroll-target="#referencias"><span class="header-section-number">15</span> Referencias</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.html">Casualidad vs causalidad</a></li><li class="breadcrumb-item"><a href="../capitulos/Capítulo3.4.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">set default theme</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Pasos para estimar causalidad</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Analizaremos el siguiente ejemplo “relación causal entre uso de mosquiteros y malaria” con técnicas que aprendemos a lo largo de este programa.</p>
<p><strong>Pasos</strong></p>
<ol type="1">
<li><p>Especifique una pregunta causal</p></li>
<li><p>Dibujar nuestras suposiciones usando un diagrama causal.</p></li>
<li><p>Modele nuestras suposiciones</p></li>
<li><p>Diagnosticar nuestros modelos</p></li>
<li><p>Estimar el efecto causal.</p></li>
<li><p>Realizar análisis de sensibilidad sobre la estimación del efecto.</p></li>
</ol>
<p>Nos centraremos en las ideas más amplias detrás de cada paso y cómo se ven en conjunto; sin embargo, no esperamos que digiera completamente cada idea. Pasaremos el resto del programa analizando cada paso en detalle.</p>
<section id="especificar-una-pregunta-causal" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="especificar-una-pregunta-causal">
<span class="header-section-number">14.1</span> Especificar una pregunta causal</h2>
<p>Pregunta: ¿el uso de un mosquitero reduce el riesgo de malaria?</p>
<p>Alrededor del 86% de las muertes por malaria ocurrieron en 29 países. Casi la mitad de todas las muertes por malaria ocurrieron en sólo seis de esos países: Nigeria (27%), la República Democrática del Congo (12%), Uganda (5%), Mozambique (4%), Angola (3%) y Burkina Faso (3%). La mayoría de estas muertes ocurrieron en niños menores de 5 años.</p>
<p>Los mosquiteros previenen la morbilidad y la mortalidad debidas a la malaria al proporcionar una barrera contra las picaduras infecciosas del principal huésped de los parásitos de la malaria, el mosquito. Los seres humanos han utilizado mosquiteros desde la antigüedad. Heródoto, el autor griego de Las Historias del siglo V a. C. , observó que los egipcios usaban sus redes de pesca como mosquiteros.</p>
<p>Muchas redes modernas también se tratan con insecticida, que se remonta a los soldados rusos en la Segunda Guerra Mundial ( Nevill et al.&nbsp;1996 ) , aunque algunas personas todavía las usan como redes de pesca ( Gettleman 2015 ) .</p>
<p>Es fácil imaginar un ensayo aleatorio que aborde esta pregunta: los participantes de un estudio son asignados aleatoriamente para usar un mosquitero y los seguimos a lo largo del tiempo para ver si hay una diferencia en el riesgo de malaria entre los grupos. La aleatorización es a menudo la mejor manera de estimar un efecto causal de una intervención porque reduce la cantidad de supuestos que necesitamos hacer para que esa estimación sea válida (analizaremos estos supuestos en la Sección 3.3 ). En particular, la aleatorización aborda muy bien los factores de confusión, teniendo en cuenta factores de confusión que tal vez ni siquiera conozcamos.</p>
<p>Varios ensayos históricos han estudiado los efectos del uso de mosquiteros sobre el riesgo de malaria, y varios estudios esenciales se realizaron en la década de 1990. Un metaanálisis de 2004 encontró que los mosquiteros tratados con insecticida reducían la mortalidad infantil en un 17%, la prevalencia del parásito de la malaria en un 13% y los casos de malaria grave y no complicada en aproximadamente un 50% (en comparación con ningún mosquitero) ( Lengeler 2004 ) . Desde que la Organización Mundial de la Salud comenzó a recomendar mosquiteros tratados con insecticidas, la resistencia a los insecticidas ha sido una gran preocupación. Sin embargo, un análisis de seguimiento de los ensayos encontró que aún no ha impactado los beneficios de los mosquiteros para la salud pública ( Pryce, Richardson y Lengeler 2018 ) .</p>
<p>Hay varias razones por las que es posible que no podamos realizar un ensayo aleatorio, incluidas la ética, el costo y el tiempo. Disponemos de pruebas sustanciales y sólidas a favor del uso de mosquiteros, pero consideremos algunas condiciones en las que la inferencia causal observacional podría ayudar.</p>
<ul>
<li><p>Es interesante cómo los estudios observacionales pueden proporcionar información valiosa, especialmente en situaciones donde realizar ensayos controlados aleatorios podría ser difícil, poco ético o llevar mucho tiempo. En el caso del uso de mosquiteros para combatir la malaria, los estudios observacionales pueden ser una herramienta poderosa para comprender mejor los efectos en diferentes poblaciones y contextos.</p></li>
<li><p>Por ejemplo, en el caso ético que mencionamos, donde ya sabemos que los mosquiteros son muy eficaces, sería poco ético retenerlos para llevar a cabo un ensayo controlado aleatorio. En su lugar, los estudios observacionales pueden proporcionar información sobre los efectos a largo plazo del uso de mosquiteros en la primera infancia, como el estudio que mencionamos sobre la supervivencia hasta la edad adulta en Tanzania.</p></li>
<li><p>Además, como mencionamos, los estudios observacionales también pueden ayudar a comprender efectos que pueden ser difíciles de investigar con ensayos controlados aleatorios, como el impacto de los mosquiteros en toda la comunidad, no solo en aquellos que los usan directamente. Esto puede ser especialmente relevante para políticas de salud pública y programas de intervención.</p></li>
</ul>
<p>Cuando realizamos un estudio observacional, sigue siendo útil pensar en el ensayo aleatorio que realizaríamos si fuera posible. El ensayo que intentamos emular en este análisis causal es el ensayo objetivo. Considerar el ensayo objetivo nos ayuda a hacer que nuestra pregunta causal sea más precisa. Consideremos la pregunta causal planteada anteriormente: ¿el uso de un mosquitero reduce el riesgo de malaria?</p>
<p>Esta pregunta es relativamente sencilla, pero aún vaga, por lo que, necesitamos aclarar algunas áreas clave:</p>
<ul>
<li><p>¿Qué queremos decir con “mosquitero”? Hay varios tipos de mosquiteros: mosquiteros sin tratar, mosquiteros tratados con insecticida y mosquiteros más nuevos y duraderos tratados con insecticida.</p></li>
<li><p>¿Riesgo comparado con qué? ¿Estamos, por ejemplo, comparando los mosquiteros tratados con insecticida con la ausencia de mosquiteros? ¿Redes sin tratar? ¿O estamos comparando un nuevo tipo de mosquitero, como los mosquiteros de larga duración tratados con insecticida, con mosquiteros que ya están en uso?</p></li>
<li><p>¿Riesgo definido por qué? ¿Una persona contrajo malaria o no? ¿Si una persona murió de malaria?</p></li>
<li><p>¿Riesgo entre quiénes? ¿Cuál es la población a la que estamos tratando de aplicar este conocimiento? ¿A quién es práctico incluir en nuestro estudio? ¿A quién podríamos necesitar excluir?</p></li>
</ul>
<p>Usaremos datos simulados para responder una pregunta más específica: ¿El uso de mosquiteros tratados con insecticida, en comparación con ningún mosquitero, disminuye el riesgo de contraer malaria después de 1 año?</p>
<p><em>Los investigadores están interesados en saber si el uso de mosquiteros disminuye el riesgo de que un individuo contraiga malaria. Han recopilado datos de 1.752 hogares en un país no identificado y tienen variables relacionadas con factores ambientales, salud individual y características del hogar. Los datos no son experimentales : los investigadores no tienen control sobre quién usa mosquiteros, y los hogares individuales toman sus propias decisiones sobre si solicitar mosquiteros gratuitos o comprar sus propios mosquiteros, así como si los usan si los tienen.</em></p>
<p>Los investigadores están interesados ​​en saber si el uso de mosquiteros disminuye el riesgo de que un individuo contraiga malaria. Han recopilado datos de 1.752 hogares en un país no identificado y tienen variables relacionadas con factores ambientales, salud individual y características del hogar. Los datos no son experimentales : los investigadores no tienen control sobre quién usa mosquiteros, y los hogares individuales toman sus propias decisiones sobre si solicitar mosquiteros gratuitos o comprar sus propios mosquiteros, así como si los usan si los tienen.</p>
<p><span class="math inline">\(id\)</span> una variable de identificación</p>
<p><span class="math inline">\(netynetnum\)</span> una variable binaria que indica si el participante usó una red (1) o no usó una red (0)</p>
<p><span class="math inline">\(malariarisk\)</span> escala de riesgo de malaria que va de 0 a 100</p>
<p><span class="math inline">\(income\)</span> ingreso semanal, medido en dólares</p>
<p><span class="math inline">\(health\)</span> una escala de puntuación de salud que va de 0 a 100</p>
<p><span class="math inline">\(household\)</span> número de personas que viven en el hogar</p>
<p><span class="math inline">\(eligible\)</span> una variable binaria que indica si el hogar es elegible para el programa neto gratuito.</p>
<p><span class="math inline">\(temperature\)</span> la temperatura promedio por la noche, en grados Celsius</p>
<p><span class="math inline">\(resistance\)</span> Resistencia a los insecticidas de los mosquitos locales. Una escala de 0 a 100, donde los valores más altos indican una mayor resistencia.</p>
<p>La distribución del riesgo de malaria parece ser bastante diferente según el uso de la red.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># install.packages('BiocManager')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ lubridate 1.9.3     ✔ tibble    3.2.1
✔ purrr     1.0.2     ✔ tidyr     1.3.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#remotes::install_github("malcolmbarrett/causalworkshop")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/malcolmbarrett/causalworkshop">causalworkshop</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">net_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">malaria_risk</span>, fill <span class="op">=</span> <span class="va">net</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">.8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figure 2.1: Gráfico de densidad del riesgo de malaria para quienes usaron y no usaron mosquiteros. El riesgo de malaria es menor para quienes usan mosquiteros.</figcaption></figure>
</div>
</div>
</div>
<p>En la Figura 2.1 , la densidad de quienes usaron mosquiteros está a la izquierda de quienes no usaron mosquiteros. La diferencia media en el riesgo de malaria es de aproximadamente 16,4, lo que sugiere que el uso de mosquiteros podría proteger contra la malaria.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">net_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">net</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>malaria_risk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">malaria_risk</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  net   malaria_risk
  &lt;lgl&gt;        &lt;dbl&gt;
1 FALSE         43.9
2 TRUE          27.5</code></pre>
</div>
</div>
<p>Y eso es lo que también vemos con la regresión lineal simple, como era de esperar.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="va">net_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">_</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     43.9     0.377     116.  0       
2 netTRUE        -16.4     0.741     -22.1 1.10e-95</code></pre>
</div>
</div>
</section><section id="dibujar-nuestras-suposiciones-usando-un-diagrama-causal" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="dibujar-nuestras-suposiciones-usando-un-diagrama-causal">
<span class="header-section-number">14.2</span> Dibujar nuestras suposiciones usando un diagrama causal</h2>
<p>El problema al que nos enfrentamos es que otros factores pueden ser responsables del efecto que estamos viendo. En este ejemplo, nos centraremos en la confusión: una causa común del uso de redes y la malaria sesgará el efecto que vemos a menos que lo tengamos en cuenta de alguna manera. Una de las mejores formas de determinar qué variables debemos tener en cuenta es utilizar un diagrama causal. Estos diagramas, también llamados gráficos acíclicos dirigidos causalmente (DAG), visualizan las suposiciones que hacemos sobre las relaciones causales entre la exposición, el resultado y otras variables que creemos que podrían estar relacionadas.</p>
<p>Aquí está el DAG que proponemos para esta pregunta.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/dag1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.2: Diagrama causal propuesto del efecto del uso de mosquiteros en la malaria. Este gráfico acíclico dirigido (DAG) establece nuestra suposición de que el uso de mosquiteros provoca una reducción en el riesgo de malaria. También dice que asumimos que el riesgo de malaria se ve afectado por el uso de mosquiteros, los ingresos, la salud, la temperatura y la resistencia a los insecticidas; el uso de Internet se ve afectado por los ingresos, la salud, la temperatura, la elegibilidad para el programa de Internet gratuito y la cantidad de personas en un hogar; la elegibilidad para los programas netos gratuitos se ve afectada por los ingresos y el número de personas en un hogar; y la salud se ve afectada por los ingresos.</figcaption></figure>
</div>
</div>
</div>
<p>En los DAG, cada punto representa una variable y cada flecha representa una causa. En otras palabras, este diagrama declara cuáles creemos que son las relaciones causales entre estas variables. En la Figura 2.2 , decimos que creemos:</p>
<ul>
<li><p>El riesgo de malaria se ve afectado causalmente por el uso de mosquiteros, los ingresos, la salud, la temperatura y la resistencia a los insecticidas.</p></li>
<li><p>El uso de Internet se ve afectado causalmente por los ingresos, la salud, la temperatura, la elegibilidad para el programa de Internet gratuito y la cantidad de personas en un hogar.</p></li>
<li><p>La elegibilidad para los programas netos gratuitos está determinada por los ingresos y la cantidad de personas en un hogar.</p></li>
<li><p>La salud se ve afectada causalmente por los ingresos.</p></li>
</ul>
<p>Puede estar de acuerdo o en desacuerdo con algunas de estas afirmaciones. ¡Eso es bueno! Dejar al descubierto nuestras suposiciones nos permite considerar la credibilidad científica de nuestro análisis. Otro beneficio de usar DAG es que, gracias a sus matemáticas, podemos determinar con precisión el subconjunto de variables que debemos tener en cuenta si asumimos que este DAG es correcto.</p>
<p>El principal problema al que nos enfrentamos es que, cuando analizamos los datos con los que trabajamos, vemos el impacto del uso de la red en el riesgo de malaria y de todas estas otras relaciones . En la terminología DAG, tenemos más de una vía causal abierta. Si este DAG es correcto, tenemos ocho vías causales: la ruta entre el uso de redes y el riesgo de malaria y otras siete vías de confusión .</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/dag2.png" class="img-fluid figure-img" width="1344"></p>
<figcaption>Figura 2.3: En el DAG propuesto, hay ocho vías abiertas que contribuyen al efecto causal observado en la regresión ingenua: el efecto real (en verde) del uso de mosquiteros sobre el riesgo de malaria y otras siete vías de confusión (en naranja). La estimación ingenua es errónea porque es una combinación de todos estos efectos.</figcaption></figure>
</div>
</div>
</div>
<p>Cuando calculamos una regresión lineal ingenua que solo incluye el uso de redes y el riesgo de malaria, el efecto que vemos es incorrecto porque las otras siete vías de confusión en la Figura 2.3 lo distorsionan. En terminología DAG, debemos bloquear estos caminos abiertos que distorsionan la estimación causal que buscamos. (Podemos bloquear caminos a través de varias técnicas, incluyendo estratificación, emparejamiento, ponderación y más). Afortunadamente, al especificar un DAG, podemos determinar con precisión las variables que necesitamos controlar. Para este DAG, necesitamos controlar tres variables: salud, ingresos y temperatura. Estas tres variables son un conjunto de ajuste mínimo , el conjunto (o conjuntos) mínimo de variables que necesita para bloquear todas las vías de confusión.</p>
</section><section id="modele-nuestras-suposiciones" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="modele-nuestras-suposiciones">
<span class="header-section-number">14.3</span> Modele nuestras suposiciones</h2>
<p>Usaremos una técnica llamada Ponderación de probabilidad inversa (IPW) para controlar estas variables. Usaremos la regresión logística para predecir la probabilidad de tratamiento: la puntuación de propensión. Luego, calcularemos ponderaciones de probabilidad inversa para aplicarlas al modelo de regresión lineal que ajustamos anteriormente. El modelo de puntuación de propensión incluye la exposición (uso neto) como variable dependiente y el ajuste mínimo establecido como variables independientes.</p>
<p>El modelo de puntuación de propensión es un modelo de regresión logística con la fórmula <span class="math inline">\(net ~ income + health + temperature\)</span>, que predice la probabilidad de uso de mosquiteros en función de los factores de confusión ingreso, salud y temperatura.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">propensity_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">net</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">temperature</span>,</span>
<span>  data <span class="op">=</span> <span class="va">net_data</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the first six propensity scores</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">propensity_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6 
0.2464385 0.2178480 0.3230129 0.2307043 0.2789042 0.3060484 </code></pre>
</div>
</div>
<p>Podemos utilizar las puntuaciones de propensión para controlar los factores de confusión de varias maneras. En este ejemplo, nos centraremos en la ponderación. En concreto, calcularemos la ponderación de probabilidad inversa para el efecto medio del tratamiento (EAT). El ATE representa una pregunta causal concreta: ¿qué pasaría si todos los participantes en el estudio utilizaran mosquiteras frente a qué pasaría si nadie en el estudio utilizara mosquiteras?</p>
<p>Para calcular el ATE, utilizaremos los paquetes broom y propensity. La función augment() de broom extrae información relacionada con la predicción del modelo y la une a los datos. La función wt_ate() de propensity calcula la ponderación de probabilidad inversa dada la puntuación de propensión y la exposición.</p>
<p>Para la ponderación de probabilidad inversa, la ponderación ATE es la probabilidad de recibir el tratamiento que realmente recibió. En otras palabras, si utilizó un mosquitero, la ponderación ATE es la probabilidad de que utilizara un mosquitero, y si no lo utilizó, es la probabilidad de que no lo utilizara.</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/malcolmbarrett/propensity">propensity</a></span><span class="op">)</span></span>
<span><span class="va">net_data_wts</span> <span class="op">&lt;-</span> <span class="va">propensity_model</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">net_data</span>, type.predict <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># .fitted is the value predicted by the model</span></span>
<span>  <span class="co"># for a given observation</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wts <span class="op">=</span> <span class="fu"><a href="https://r-causal.github.io/propensity/reference/wt_ate.html">wt_ate</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">net</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ Treating `.exposure` as binary</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">net_data_wts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">net</span>, <span class="va">.fitted</span>, <span class="va">wts</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,752 × 3
   net   .fitted   wts
   &lt;lgl&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 FALSE   0.246  1.33
 2 FALSE   0.218  1.28
 3 FALSE   0.323  1.48
 4 FALSE   0.231  1.30
 5 FALSE   0.279  1.39
 6 FALSE   0.306  1.44
 7 FALSE   0.332  1.50
 8 FALSE   0.168  1.20
 9 FALSE   0.222  1.29
10 FALSE   0.255  1.34
# ℹ 1,742 more rows</code></pre>
</div>
</div>
<p>wts representa la cantidad en que cada observación será ponderada al alza o a la baja en el modelo de resultados que pronto ajustaremos. Por ejemplo, el hogar número 16 utilizó un mosquitero y tuvo una probabilidad prevista de 0,41. Es una probabilidad bastante baja teniendo en cuenta que, de hecho, utilizaron un mosquitero. Se trata de una probabilidad bastante baja teniendo en cuenta que, de hecho, utilizaron un mosquitero, por lo que su ponderación es mayor, 2,42. En otras palabras, este hogar tendrá una ponderación superior a la del modelo lineal ingenuo que ajustamos anteriormente. El primer hogar no utilizó mosquitero; su probabilidad prevista de utilizar mosquitero fue de 0,25 (o dicho de otro modo, una probabilidad prevista de no utilizar mosquitero de 0,75). Esto está más en consonancia con el valor observado del mosquitero, pero sigue existiendo cierta probabilidad prevista de utilizar mosquitero, por lo que su ponderación es de 1,28.</p>
</section><section id="diagnosticar-nuestros-modelos" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="diagnosticar-nuestros-modelos">
<span class="header-section-number">14.4</span> Diagnosticar nuestros modelos</h2>
<p>El objetivo de la ponderación del puntaje de propensión es ponderar la población de observaciones de manera que la distribución de los factores de confusión esté equilibrada entre los grupos de exposición. Dicho de otra manera, en principio estamos eliminando las flechas entre los factores de confusión y la exposición en el DAG, de modo que las rutas de confusión ya no distorsionen nuestras estimaciones. Aquí está la distribución de la puntuación de propensión por grupo, creada a partir geom_mirror_histogram()del paquete de <em>halfmoon</em> para evaluar el equilibrio en los modelos de puntuación de propensión:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-causal/halfmoon">halfmoon</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">net_data_wts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/halfmoon/reference/geom_mirror_histogram.html">geom_mirror_histogram</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">net</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">abs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"propensity score"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.4: Histograma reflejado de las puntuaciones de propensión de quienes usaron mosquiteros (arriba, azul) versus quienes no los usaron (abajo, naranja). El rango de puntuaciones de propensión es similar entre los grupos, con aquellos que usaron mosquiteros ligeramente a la izquierda de aquellos que no lo hicieron, pero las formas de la distribución son diferentes.</figcaption></figure>
</div>
</div>
</div>
<p>La puntuación de propensión ponderada crea una pseudopoblación donde las distribuciones son mucho más similares:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">net_data_wts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">.fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/halfmoon/reference/geom_mirror_histogram.html">geom_mirror_histogram</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">net</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/halfmoon/reference/geom_mirror_histogram.html">geom_mirror_histogram</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">net</span>, weight <span class="op">=</span> <span class="va">wts</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">abs</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"propensity score"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.5: Histograma reflejado de las puntuaciones de propensión de quienes usaron mosquiteros (arriba, azul) versus quienes no los usaron (abajo, naranja). La región sombreada representa la distribución no ponderada y la región coloreada representa las distribuciones ponderadas. El ATE pondera los grupos para que sean similares en el rango y la forma de la distribución de las puntuaciones de propensión.</figcaption></figure>
</div>
</div>
</div>
<p>En este ejemplo, las distribuciones no ponderadas no son terribles (las formas son algo similares aquí y la superposición bastante), pero las distribuciones ponderadas en la Figura 2.5 son mucho más similares.</p>
<p><strong>NOTA: Confusión no medida</strong> <em>La ponderación del puntaje de propensión y la mayoría de las otras técnicas de inferencia causal solo ayudan con los factores de confusión observados (aquellos que modelamos correctamente, además). Lamentablemente, es posible que todavía tengamos factores de confusión no medidos, que analizaremos a continuación. La aleatorización es una técnica de inferencia causal que aborda la confusión no medida, una de las razones por las que es tan poderosa.</em></p>
<p>También es posible que deseemos saber qué tan equilibrados están los grupos según cada factor de confusión. Una forma de hacerlo es calcular las diferencias de medias estandarizadas (DME) para cada factor de confusión con y sin ponderaciones. Calcularemos los SMD y tidy_smd()luego los trazaremos con geom_love().</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/tidysmd/reference/tidy_smd.html">tidy_smd</a></span><span class="op">(</span></span>
<span>  <span class="va">net_data_wts</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">health</span>, <span class="va">temperature</span><span class="op">)</span>,</span>
<span>  .group <span class="op">=</span> <span class="va">net</span>,</span>
<span>  .wts <span class="op">=</span> <span class="va">wts</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">plot_df</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">smd</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    group <span class="op">=</span> <span class="va">method</span>,</span>
<span>    color <span class="op">=</span> <span class="va">method</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/tidysmd/reference/geom_love.html">geom_love</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.6: Gráfico de love que representa las diferencias de medias estandarizadas (DME) entre grupos de exposición de tres factores de confusión: temperatura, ingresos y salud. Antes de la ponderación, existen diferencias considerables entre los grupos. Después de la ponderación, los factores de confusión están mucho más equilibrados entre los grupos.</figcaption></figure>
</div>
</div>
</div>
<p>Una pauta estándar es que los factores de confusión equilibrados deben tener una DME inferior a 0,1 en la escala absoluta. 0,1 es sólo una regla general, pero si la seguimos, las variables de la Figura 2.6 están bien equilibradas después de la ponderación (y desequilibradas antes de la ponderación).</p>
<p>Antes de aplicar las ponderaciones al modelo de resultados, verifiquemos su distribución general en busca de ponderaciones extremas. Las ponderaciones extremas pueden desestabilizar la estimación y la varianza en el modelo de resultados, por lo que queremos ser conscientes de ello.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">net_data_wts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">wts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#CC79A7"</span>, color <span class="op">=</span> <span class="cn">NA</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.7: Gráfico de densidad de las ponderaciones promedio del efecto del tratamiento (ATE). La gráfica está sesgada, con valores más altos hacia 8. Esto puede indicar un problema con el modelo, pero las ponderaciones no son tan extremas como para desestabilizar la varianza de la estimación.</figcaption></figure>
</div>
</div>
</div>
<p>Las ponderaciones de la Figura 2.7 están sesgadas, pero no hay valores escandalosos. Si viéramos pesos extremos, podríamos intentar recortarlos o estabilizarlos, o considerar calcular un efecto para una estimación diferente</p>
</section><section id="estimar-el-efecto-causal" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="estimar-el-efecto-causal">
<span class="header-section-number">14.5</span> Estimar el efecto causal</h2>
<p>Ahora estamos listos para usar las ponderaciones ATE para (intentar) tener en cuenta la confusión en el ingenuo modelo de regresión lineal. En este caso, ajustar un modelo de este tipo es agradablemente sencillo: ajustamos el mismo modelo que antes pero con weights = wts, que incorporará las ponderaciones de probabilidad inversas.</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">net_data_wts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">_</span>, weights <span class="op">=</span> <span class="va">wts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span>conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic  p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)     42.7     0.442      96.7 0            41.9      43.6
2 netTRUE        -12.5     0.624     -20.1 5.50e-81    -13.8     -11.3</code></pre>
</div>
</div>
<p>La estimación del efecto promedio del tratamiento es -12,5 (IC del 95%: -13,8; -11,3). Desafortunadamente, los intervalos de confianza que estamos usando son incorrectos porque no tienen en cuenta la dependencia dentro de las ponderaciones. Generalmente, los intervalos de confianza para los modelos ponderados por puntuación de propensión serán demasiado estrechos a menos que corrijamos esta dependencia. Por lo tanto, la cobertura nominal de los intervalos de confianza será incorrecta (no son IC del 95% porque su cobertura es mucho menor que el 95%) y puede dar lugar a interpretaciones erróneas.</p>
<p>Tenemos varias formas de abordar este problema, incluido el bootstrap, los errores estándar robustos y la contabilidad manual de la dependencia con estimadores empíricos tipo sándwich. Para este ejemplo, usaremos bootstrap, una herramienta flexible que calcula distribuciones de parámetros mediante remuestreo. Usaremos el paquete rsample del ecosistema tidymodels para trabajar con muestras de arranque.</p>
<p>¡Acabamos de estimarlos usando regresión logística! Necesitamos dar cuenta de esta incertidumbre iniciando todo el proceso de modelación . Para cada muestra de arranque, debemos ajustar el modelo de puntuación de propensión, calcular las ponderaciones de probabilidad inversa y luego ajustar el modelo de resultado ponderado.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_ipw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">split</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># get bootstrapped data sample with `rsample::analysis()`</span></span>
<span>  <span class="va">.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html">analysis</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># fit propensity score model</span></span>
<span>  <span class="va">propensity_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span></span>
<span>    <span class="va">net</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">health</span> <span class="op">+</span> <span class="va">temperature</span>,</span>
<span>    data <span class="op">=</span> <span class="va">.df</span>,</span>
<span>    family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># calculate inverse probability weights</span></span>
<span>  <span class="va">.df</span> <span class="op">&lt;-</span> <span class="va">propensity_model</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span>type.predict <span class="op">=</span> <span class="st">"response"</span>, data <span class="op">=</span> <span class="va">.df</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>wts <span class="op">=</span> <span class="fu"><a href="https://r-causal.github.io/propensity/reference/wt_ate.html">wt_ate</a></span><span class="op">(</span><span class="va">.fitted</span>, <span class="va">net</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># fit correctly bootstrapped ipw model</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">malaria_risk</span> <span class="op">~</span> <span class="va">net</span>, data <span class="op">=</span> <span class="va">.df</span>, weights <span class="op">=</span> <span class="va">wts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ahora que sabemos exactamente cómo calcular la estimación para cada iteración, creemos el conjunto de datos de arranque con bootstraps()la función rsample. El timesargumento determina cuántos conjuntos de datos arrancados se crearán; haremos 1.000.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bootstrapped_net_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/bootstraps.html">bootstraps</a></span><span class="op">(</span></span>
<span>  <span class="va">net_data</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  <span class="co"># required to calculate CIs later</span></span>
<span>  apparent <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bootstrapped_net_data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling with apparent sample 
# A tibble: 1,001 × 2
   splits             id           
   &lt;list&gt;             &lt;chr&gt;        
 1 &lt;split [1752/641]&gt; Bootstrap0001
 2 &lt;split [1752/630]&gt; Bootstrap0002
 3 &lt;split [1752/630]&gt; Bootstrap0003
 4 &lt;split [1752/638]&gt; Bootstrap0004
 5 &lt;split [1752/641]&gt; Bootstrap0005
 6 &lt;split [1752/651]&gt; Bootstrap0006
 7 &lt;split [1752/637]&gt; Bootstrap0007
 8 &lt;split [1752/638]&gt; Bootstrap0008
 9 &lt;split [1752/662]&gt; Bootstrap0009
10 &lt;split [1752/640]&gt; Bootstrap0010
# ℹ 991 more rows</code></pre>
</div>
</div>
<p>El resultado es un marco de datos anidado: cada splitsobjeto contiene metadatos que rsample utiliza para subconjuntos de muestras de arranque para cada una de las 1000 muestras. A continuación, ejecutaremos fit_ipw()1000 veces para crear una distribución para estimate. En esencia, el cálculo que estamos haciendo es</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">fit_ipw</span><span class="op">(</span><span class="va">bootstrapped_net_data</span><span class="op">$</span><span class="va">splits</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Donde n es uno de 1000 índices. Usaremos map()la función de purrr para iterar a través de cada splitobjeto.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipw_results</span> <span class="op">&lt;-</span> <span class="va">bootstrapped_net_data</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>boot_fits <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">splits</span>, <span class="va">fit_ipw</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipw_results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Bootstrap sampling with apparent sample 
# A tibble: 1,001 × 3
   splits             id            boot_fits       
   &lt;list&gt;             &lt;chr&gt;         &lt;list&gt;          
 1 &lt;split [1752/641]&gt; Bootstrap0001 &lt;tibble [2 × 5]&gt;
 2 &lt;split [1752/630]&gt; Bootstrap0002 &lt;tibble [2 × 5]&gt;
 3 &lt;split [1752/630]&gt; Bootstrap0003 &lt;tibble [2 × 5]&gt;
 4 &lt;split [1752/638]&gt; Bootstrap0004 &lt;tibble [2 × 5]&gt;
 5 &lt;split [1752/641]&gt; Bootstrap0005 &lt;tibble [2 × 5]&gt;
 6 &lt;split [1752/651]&gt; Bootstrap0006 &lt;tibble [2 × 5]&gt;
 7 &lt;split [1752/637]&gt; Bootstrap0007 &lt;tibble [2 × 5]&gt;
 8 &lt;split [1752/638]&gt; Bootstrap0008 &lt;tibble [2 × 5]&gt;
 9 &lt;split [1752/662]&gt; Bootstrap0009 &lt;tibble [2 × 5]&gt;
10 &lt;split [1752/640]&gt; Bootstrap0010 &lt;tibble [2 × 5]&gt;
# ℹ 991 more rows</code></pre>
</div>
</div>
<p>El resultado es otro marco de datos anidado con una nueva columna, boot_fits. Cada elemento de boot_fitses el resultado del IPW para el conjunto de datos iniciado. Por ejemplo, en el primer conjunto de datos iniciado, los resultados de IPW fueron:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipw_results</span><span class="op">$</span><span class="va">boot_fits</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)     43.0     0.445      96.5 0       
2 netTRUE        -13.2     0.629     -21.0 1.15e-87</code></pre>
</div>
</div>
<p>Ahora tenemos una distribución de estimaciones:</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ipw_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    estimate <span class="op">=</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span></span>
<span>      <span class="va">boot_fits</span>,</span>
<span>      <span class="co"># pull the `estimate` for `netTRUE` for each fit</span></span>
<span>      \<span class="op">(</span><span class="va">.fit</span><span class="op">)</span> <span class="va">.fit</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"netTRUE"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#D55E00FF"</span>, color <span class="op">=</span> <span class="st">"white"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.8: “Un histograma de 1.000 estimaciones iniciales del efecto del uso de mosquiteros sobre el riesgo de malaria. La dispersión de estas estimaciones explica la dependencia y la incertidumbre en el uso de ponderaciones IPW”.</figcaption></figure>
</div>
</div>
</div>
<p>La Figura 2.8 da una idea de la variación en estimate, pero calculemos intervalos de confianza del 95% a partir de la distribución inicializada utilizando rsample int_t():</p>
<div class="cell">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">boot_estimate</span> <span class="op">&lt;-</span> <span class="va">ipw_results</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># calculate T-statistic-based CIs</span></span>
<span>  <span class="fu"><a href="https://rsample.tidymodels.org/reference/int_pctl.html">int_t</a></span><span class="op">(</span><span class="va">boot_fits</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"netTRUE"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  term    .lower .estimate .upper .alpha .method  
  &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    
1 netTRUE  -13.4     -12.5  -11.7   0.05 student-t</code></pre>
</div>
</div>
<p>Ahora tenemos una estimación ajustada por factores de confusión con errores estándar correctos. La estimación del efecto de que todos los hogares usen mosquiteros versus ningún hogar que los use sobre el riesgo de malaria es -12,6 (IC del 95%: -13,4, -11,7). De hecho, los mosquiteros parecen reducir el riesgo de malaria en este estudio.</p>
</section><section id="realizar-análisis-de-sensibilidad-sobre-la-estimación-del-efecto." class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="realizar-análisis-de-sensibilidad-sobre-la-estimación-del-efecto.">
<span class="header-section-number">14.6</span> Realizar análisis de sensibilidad sobre la estimación del efecto.</h2>
<p>Hemos trazado una hoja de ruta para tomar datos de observación, pensar críticamente sobre la pregunta causal que queremos plantear, identificar los supuestos que necesitamos para llegar allí y luego aplicar esos supuestos a un modelo estadístico. Obtener la respuesta correcta a la pregunta causal depende de que nuestras suposiciones sean más o menos correctas. ¿Pero qué pasa si estamos más en el lado menos correcto?</p>
<p>Alerta de spoiler: la respuesta que acabamos de calcular es incorrecta . ¡Después de todo ese esfuerzo!</p>
<p>Al realizar un análisis causal, es una buena idea utilizar análisis de sensibilidad para probar sus suposiciones. Hay muchas fuentes potenciales de sesgo en cualquier estudio y muchos análisis de sensibilidad que las acompañan; Nos centraremos en el supuesto de que no hay confusión.</p>
<p>Comencemos con un análisis de sensibilidad amplio; luego, haremos preguntas sobre factores de confusión específicos no medidos. Cuando tenemos menos información sobre los factores de confusión no medidos, podemos utilizar el análisis del punto de inflexión para preguntar cuántos factores de confusión se necesitarían para inclinar mi estimación al valor nulo. En otras palabras, ¿cuál tendría que ser la fuerza del factor de confusión no medido para explicar nuestros resultados? El paquete tipr es un conjunto de herramientas para realizar análisis de sensibilidad. Examinemos el punto de inflexión de un factor de confusión desconocido y de distribución normal. La tip_coef()función toma una estimación (un coeficiente beta de un modelo de regresión, o el límite superior o inferior del coeficiente). Además, requiere 1) diferencias escaladas en las medias del factor de confusión entre los grupos de exposición o 2) efecto del factor de confusión sobre el resultado. Para la estimación, usaremos conf.high, que está más cerca de 0 (el nulo), y preguntaremos: ¿en qué medida el factor de confusión tendría que afectar el riesgo de malaria para tener un intervalo de confianza superior insesgado de 0? Usaremos tipr para calcular esta respuesta para 5 escenarios, donde la diferencia media en el factor de confusión entre los grupos de exposición es 1, 2, 3, 4 o 5.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-causal.github.io/tipr/">tipr</a></span><span class="op">)</span></span>
<span><span class="va">tipping_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-causal.github.io/tipr/reference/tip_coef.html">tip_coef</a></span><span class="op">(</span><span class="va">boot_estimate</span><span class="op">$</span><span class="va">.upper</span>, exposure_confounder_effect <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The observed effect (-11.7, -11.7, -11.7, -11.7, and -11.7) WOULD be tipped
  by 1, 1, 1, 1, and 1 unmeasured confounder, , , , and with the following
  specifications:
• estimated difference in scaled means between the unmeasured confounder in the
  exposed population and unexposed population: 1, 2, 3, 4, and 5
• estimated relationship between the unmeasured confounder and the outcome:
  -11.7, -5.85, -3.9, -2.92, and -2.34</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tipping_points</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">confounder_outcome_effect</span>, <span class="va">exposure_confounder_effect</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"#009E73"</span>, linewidth <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"#009E73"</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">2.5</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Confounder-Outcome Effect"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Scaled mean differences in\n confounder between exposure groups"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Capítulo3.4_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.9: Un análisis del punto de inflexión bajo varios escenarios de confusión donde el factor de confusión no medido es una variable continua normalmente distribuida. La línea representa la fuerza de la confusión necesaria para inclinar el intervalo de confianza superior de la estimación del efecto causal a 0. El eje x representa el coeficiente de la relación entre el factor de confusión y el resultado ajustado para la exposición y el conjunto de factores de confusión medidos. El eje y representa la diferencia media escalada del factor de confusión entre los grupos de exposición.</figcaption></figure>
</div>
</div>
</div>
<p>Si tuviéramos un factor de confusión no medido donde la diferencia de medias estandarizada entre los grupos de exposición fuera 1, el factor de confusión necesitaría disminuir el riesgo de malaria en aproximadamente -11,7. Esto es bastante fuerte en comparación con otros efectos, pero puede ser factible si tenemos una idea de algo que podríamos haber pasado por alto. Por el contrario, supongamos que la relación entre el uso neto y el factor de confusión no medido es muy fuerte, con una diferencia media escalada de 5. En ese caso, la relación entre el factor de confusión y la malaria sólo necesita ser 5. Ahora tenemos que considerar: ¿cuáles de estos escenarios son ¿Es plausible dado nuestro conocimiento del dominio y los efectos que vemos en este análisis?</p>
<p>Ahora consideremos un análisis de sensibilidad mucho más específico. Algunos grupos étnicos, como los fulani, tienen resistencia genética a la malaria ( Arama et al.&nbsp;2015 ) . Digamos que en nuestros datos simulados, un grupo étnico no identificado en el país no identificado comparte esta resistencia genética a la malaria. Por razones históricas, el uso de mosquiteros en este grupo también es muy elevado. No tenemos esta variable en net_data, pero digamos que sabemos por la literatura que en esta muestra podemos estimar en:</p>
<ul>
<li><p>Las personas con esta resistencia genética tienen, en promedio, un riesgo de malaria de aproximadamente 10 veces menor.</p></li>
<li><p>Alrededor del 26% de las personas que usan mosquiteros en nuestro estudio tienen esta resistencia genética.</p></li>
<li><p>Alrededor del 5% de las personas que no usan mosquiteros tienen esta resistencia genética.</p></li>
</ul>
<p>Con esta cantidad de información, podemos usar tipr para ajustar las estimaciones que calculamos para el factor de confusión no medido. Usaremos adjust_coef_with_binary()para calcular las estimaciones ajustadas.</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adjusted_estimates</span> <span class="op">&lt;-</span> <span class="va">boot_estimate</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.estimate</span>, <span class="va">.lower</span>, <span class="va">.upper</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-causal.github.io/tipr/reference/adjust_coef_with_binary.html">adjust_coef_with_binary</a></span><span class="op">(</span></span>
<span>    exposed_confounder_prev <span class="op">=</span> <span class="fl">0.26</span>,</span>
<span>    unexposed_confounder_prev <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    confounder_outcome_effect <span class="op">=</span> <span class="op">-</span><span class="fl">10</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ℹ The observed effect (-12.55, -13.43, and -11.7) is updated to -10.45, -11.33,
  and -9.6 by a confounder with the following specifications:
• estimated prevalence of the unmeasured confounder in the exposed population:
  0.26
• estimated prevalence of the unmeasured confounder in the unexposed
  population: 0.05
• estimated relationship between the unmeasured confounder and the outcome: -10</code></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adjusted_estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  effect_adjusted effect_observed exposure_confounder_e…¹ confounder_outcome_e…²
            &lt;dbl&gt;           &lt;dbl&gt;                   &lt;dbl&gt;                  &lt;dbl&gt;
1          -10.4            -12.5                    0.21                    -10
2          -11.3            -13.4                    0.21                    -10
3           -9.60           -11.7                    0.21                    -10
# ℹ abbreviated names: ¹​exposure_confounder_effect, ²​confounder_outcome_effect</code></pre>
</div>
</div>
<p>La estimación ajustada para una situación en la que la resistencia genética a la malaria es un factor de confusión es -12,3 (IC del 95%: -13,1; -11,5).</p>
<p>De hecho, estos datos fueron simulados con ese factor de confusión. El verdadero efecto del uso de mosquiteros sobre la malaria es aproximadamente -10, y el verdadero DAG que generó estos datos es:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="fig/DAG3.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Figura 2.10: El verdadero diagrama causal de net_data. Este DAG es idéntico al que propusimos con una adición: la resistencia genética a la malaria reduce causalmente el riesgo de malaria e impacta el uso de redes. Por lo tanto, es un factor de confusión y forma parte del conjunto de ajustes mínimo necesario para obtener una estimación imparcial del efecto. En otras palabras, al no incluirlo, hemos calculado el efecto equivocado.</figcaption></figure>
</div>
</div>
</div>
<p>El factor de confusión no medido en la Figura 2.10 está disponible en el conjunto de datos net_data_fullcomo genetic_resistance. Si volvemos a calcular la estimación del IPW del efecto promedio del tratamiento con mosquiteros sobre el riesgo de malaria, obtenemos -10,2 (IC del 95%: -11,2; -9,3), mucho más cerca de la respuesta real de -10.</p>
<p>¿Qué opinas? ¿Es confiable esta estimación? ¿Hicimos un buen trabajo al abordar los supuestos que debemos hacer para un efecto causal, principalmente que no hay confusión? ¿Cómo criticarías este modelo y qué harías diferente? Vale, sabemos que -10 es la respuesta correcta porque los datos son simulados, pero en la práctica nunca podemos estar seguros, por lo que debemos seguir investigando nuestras suposiciones hasta que estemos seguros de que son sólidas.</p>
</section><section id="referencias" class="level1" data-number="15"><h1 data-number="15">
<span class="header-section-number">15</span> Referencias</h1>
<ul>
<li><p>Ross, R.D., Shi, X., Caram, M.E.V. et al.&nbsp;Veridical causal inference using propensity score methods for comparative effectiveness research with medical claims. Health Serv Outcomes Res Method (2020). <a href="https://doi.org/10.1007/s10742-020-00222-8" class="uri">https://doi.org/10.1007/s10742-020-00222-8</a></p></li>
<li><p>Elwert, F. (2013). Graphical Causal Models. In S. L. Morgan (Ed.), <em>Handbook of Causal Analysis for Social Research</em> (pp.&nbsp;245–273). Springer.</p></li>
<li><p>Hernán, M. A., &amp; Robbins, J. M. (2020). <em>Causal Inference: What If</em>. CRC Press.</p></li>
<li><p>Morgan, S. L., &amp; Winship, C. (2007). <em>Counterfactuals and Causal Inference: Methods and Principles for Social Research</em>. Cambridge University Press.</p></li>
<li><p>Pearl, J., Glymour, M., &amp; Jewell, N. P. (2016). <em>Causal Inference in Statistics: A Primer</em>. Wiley.</p></li>
<li><p>Pearl, J., &amp; Mackenzie, D. (2018). <em>The Book of Why: The New Science of Cause and Effect</em>. Basic Books.</p></li>
<li><p>Rohrer, J. M. (2018). Thinking Clearly About Correlations and Causation: Graphical Causal Models for Observational Data. <em>Advances in Methods and Practices in Psychological Science</em>, <em>1</em>(1), 27–42.</p></li>
<li><p>Shalizi, C. R. (2019). <em>Advanced Data Analysis From an Elementary Point of view</em>. <a href="https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/ADAfaEPoV.pdf" class="uri">https://www.stat.cmu.edu/~cshalizi/ADAfaEPoV/ADAfaEPoV.pdf</a></p></li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../capitulos/Capítulo3.3.html" class="pagination-link" aria-label="Introducción">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Introducción</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../capitulos/Capítulo4.html" class="pagination-link" aria-label="¡¡¡No todo es confusión!!!">
        <span class="nav-page-text">¡¡¡No todo es confusión!!!</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>This book was built with 💕 and <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>DataLab for causal inference</p>
</div>
  </div>
</footer>


</body></html>